/**
 * @typedef {import('typeorm').MigrationInterface} MigrationInterface
 * @typedef {import('typeorm').QueryRunner} QueryRunner
 */

/**
 * @class
 * @implements {MigrationInterface}
 */
module.exports = class InitSchema1770544426586 {
    name = 'InitSchema1770544426586'

    /**
     * @param {QueryRunner} queryRunner
     */
    async up(queryRunner) {
        await queryRunner.query(`CREATE TABLE "sales" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "datetime" datetime NOT NULL DEFAULT (CURRENT_TIMESTAMP), "total" integer NOT NULL, "warehouse_id" varchar, "warehouse_name" varchar, "customer_id" integer, "customer_name" varchar, "customer_phone" varchar, "customer_email" varchar, "subtotal" integer NOT NULL DEFAULT (0), "discount_amount" integer NOT NULL DEFAULT (0), "tax_amount" integer NOT NULL DEFAULT (0), "payment_method" varchar NOT NULL DEFAULT ('cash'), "status" varchar NOT NULL DEFAULT ('completed'), "reference_number" varchar, "inventory_synced" boolean NOT NULL DEFAULT (0), "inventory_sync_date" datetime, "user_id" integer, "user_name" varchar, "notes" text, "created_at" datetime NOT NULL DEFAULT (datetime('now')), "updated_at" datetime NOT NULL DEFAULT (datetime('now')), CONSTRAINT "UQ_7eda0726704e0f1258eeb58ab4a" UNIQUE ("reference_number"))`);
        await queryRunner.query(`CREATE INDEX "idx_sales_datetime" ON "sales" ("datetime") `);
        await queryRunner.query(`CREATE INDEX "idx_sales_status" ON "sales" ("status") `);
        await queryRunner.query(`CREATE INDEX "idx_sales_reference_number" ON "sales" ("reference_number") `);
        await queryRunner.query(`CREATE INDEX "idx_sales_warehouse" ON "sales" ("warehouse_id") `);
        await queryRunner.query(`CREATE INDEX "idx_sales_customer" ON "sales" ("customer_id") `);
        await queryRunner.query(`CREATE INDEX "idx_sales_inventory_synced" ON "sales" ("inventory_synced") `);
        await queryRunner.query(`CREATE TABLE "sale_items" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "sale_id" integer NOT NULL, "product_id" integer NOT NULL, "warehouse_id" varchar, "sync_id" varchar, "inventory_synced" boolean NOT NULL DEFAULT (0), "product_name" varchar NOT NULL, "product_barcode" varchar, "product_sku" varchar, "is_variant" boolean NOT NULL DEFAULT (0), "variant_name" varchar, "quantity" integer NOT NULL, "unit_price" integer NOT NULL, "total_price" integer NOT NULL, "cost_price" integer, "profit" integer, "discount_percentage" decimal(5,2) NOT NULL DEFAULT (0), "discount_amount" integer NOT NULL DEFAULT (0), "price_before_discount" integer, "returned_quantity" integer NOT NULL DEFAULT (0), "is_returned" boolean NOT NULL DEFAULT (0), "return_reason" varchar, "return_date" datetime, "created_at" datetime NOT NULL DEFAULT (datetime('now')), "updated_at" datetime NOT NULL DEFAULT (datetime('now')))`);
        await queryRunner.query(`CREATE INDEX "idx_sale_items_sale_id" ON "sale_items" ("sale_id") `);
        await queryRunner.query(`CREATE INDEX "idx_sale_items_product_id" ON "sale_items" ("product_id") `);
        await queryRunner.query(`CREATE INDEX "idx_sale_items_is_returned" ON "sale_items" ("is_returned") `);
        await queryRunner.query(`CREATE INDEX "idx_sale_items_sync_id" ON "sale_items" ("sync_id") `);
        await queryRunner.query(`CREATE INDEX "idx_sale_items_inventory_synced" ON "sale_items" ("inventory_synced") `);
        await queryRunner.query(`CREATE TABLE "products" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "sku" varchar(100) NOT NULL, "barcode" varchar(100), "upc" varchar(50), "name" varchar(255) NOT NULL, "display_name" varchar(255), "description" text, "product_type" varchar NOT NULL DEFAULT ('simple'), "category_id" integer, "subcategory_id" integer, "brand_id" integer, "cost_price" decimal(12,2), "selling_price" decimal(12,2) NOT NULL, "wholesale_price" decimal(12,2), "min_price" decimal(12,2), "max_price" decimal(12,2), "markup_percentage" decimal(5,2), "stock" integer NOT NULL DEFAULT (0), "reserved_stock" integer NOT NULL DEFAULT (0), "available_stock" integer NOT NULL DEFAULT (0), "min_stock_level" integer NOT NULL DEFAULT (5), "max_stock_level" integer, "reorder_level" integer NOT NULL DEFAULT (10), "tax_rate" decimal(5,2) NOT NULL DEFAULT (0), "tax_type" varchar NOT NULL DEFAULT ('exclusive'), "is_taxable" boolean NOT NULL DEFAULT (1), "discount_percentage" decimal(5,2) NOT NULL DEFAULT (0), "discount_amount" decimal(10,2) NOT NULL DEFAULT (0), "weight" decimal(10,2), "weight_unit" varchar NOT NULL DEFAULT ('kg'), "length" decimal(10,2), "width" decimal(10,2), "height" decimal(10,2), "dimension_unit" varchar NOT NULL DEFAULT ('cm'), "supplier_id" integer, "supplier_sku" varchar, "supplier_price" decimal(12,2), "lead_time_days" integer NOT NULL DEFAULT (7), "has_expiry" boolean NOT NULL DEFAULT (0), "shelf_life_days" integer, "track_batch" boolean NOT NULL DEFAULT (0), "track_serial" boolean NOT NULL DEFAULT (0), "image_url" varchar, "image_urls" text, "thumbnail_url" varchar, "pos_quick_code" varchar, "pos_category_id" integer, "is_quick_sale" boolean NOT NULL DEFAULT (0), "is_hidden" boolean NOT NULL DEFAULT (0), "kitchen_printer_id" integer, "preparation_time" integer NOT NULL DEFAULT (0), "loyalty_points_earn" integer NOT NULL DEFAULT (0), "is_reward_product" boolean NOT NULL DEFAULT (0), "reward_points_cost" integer NOT NULL DEFAULT (0), "status" varchar NOT NULL DEFAULT ('active'), "is_active" boolean NOT NULL DEFAULT (1), "is_deleted" boolean NOT NULL DEFAULT (0), "is_bestseller" boolean NOT NULL DEFAULT (0), "is_featured" boolean NOT NULL DEFAULT (0), "is_new" boolean NOT NULL DEFAULT (1), "tags" text, "attributes" text, "specifications" text, "created_at" datetime NOT NULL DEFAULT (CURRENT_TIMESTAMP), "updated_at" datetime NOT NULL DEFAULT (CURRENT_TIMESTAMP), "deleted_at" datetime, "last_sold_at" datetime, "last_received_at" datetime, "created_by" integer, "updated_by" integer, "deleted_by" integer, "total_sold" integer NOT NULL DEFAULT (0), "total_returned" integer NOT NULL DEFAULT (0), "total_profit" decimal(12,2) NOT NULL DEFAULT (0), "average_rating" decimal(3,2) NOT NULL DEFAULT (0), "review_count" integer NOT NULL DEFAULT (0), CONSTRAINT "UQ_c44ac33a05b144dd0d9ddcf9327" UNIQUE ("sku"), CONSTRAINT "UQ_adfc522baf9d9b19cd7d9461b7e" UNIQUE ("barcode"))`);
        await queryRunner.query(`CREATE UNIQUE INDEX "idx_products_sku" ON "products" ("sku") `);
        await queryRunner.query(`CREATE UNIQUE INDEX "idx_products_barcode" ON "products" ("barcode") `);
        await queryRunner.query(`CREATE INDEX "idx_products_name" ON "products" ("name") `);
        await queryRunner.query(`CREATE INDEX "idx_products_status" ON "products" ("status") `);
        await queryRunner.query(`CREATE INDEX "idx_products_category" ON "products" ("category_id") `);
        await queryRunner.query(`CREATE INDEX "idx_products_supplier" ON "products" ("supplier_id") `);
        await queryRunner.query(`CREATE INDEX "idx_products_stock" ON "products" ("stock") `);
        await queryRunner.query(`CREATE INDEX "idx_products_active" ON "products" ("is_active") `);
        await queryRunner.query(`CREATE INDEX "idx_products_price" ON "products" ("selling_price") `);
        await queryRunner.query(`CREATE INDEX "idx_products_pos_quick_code" ON "products" ("pos_quick_code") `);
        await queryRunner.query(`CREATE INDEX "idx_products_type" ON "products" ("product_type") `);
        await queryRunner.query(`CREATE INDEX "idx_products_created" ON "products" ("created_at") `);
        await queryRunner.query(`CREATE INDEX "idx_products_sku_name" ON "products" ("sku", "name") `);
        await queryRunner.query(`CREATE INDEX "idx_products_supplier_sku" ON "products" ("supplier_sku") `);
        await queryRunner.query(`CREATE INDEX "idx_products_total_sold" ON "products" ("total_sold") `);
        await queryRunner.query(`CREATE INDEX "idx_products_is_deleted" ON "products" ("is_deleted") `);
        await queryRunner.query(`CREATE TABLE "audit_trails" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "action" varchar(100) NOT NULL, "entity" varchar(100) NOT NULL, "entity_id" integer NOT NULL, "details" text, "timestamp" datetime NOT NULL DEFAULT (CURRENT_TIMESTAMP), "user_id" integer NOT NULL)`);
        await queryRunner.query(`CREATE INDEX "idx_audit_entity" ON "audit_trails" ("entity", "entity_id") `);
        await queryRunner.query(`CREATE INDEX "idx_audit_user" ON "audit_trails" ("user_id") `);
        await queryRunner.query(`CREATE INDEX "idx_audit_action_time" ON "audit_trails" ("action", "timestamp") `);
        await queryRunner.query(`CREATE TABLE "users" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "username" varchar NOT NULL, "role" varchar NOT NULL, "password" varchar, "first_name" varchar, "last_name" varchar, "display_name" varchar, "created_at" datetime NOT NULL DEFAULT (datetime('now')), "updated_at" datetime NOT NULL DEFAULT (datetime('now')), "email" varchar, "is_active" boolean NOT NULL DEFAULT (1), "employee_id" varchar, "department" varchar, "can_manage_products" boolean NOT NULL DEFAULT (0), "can_adjust_inventory" boolean NOT NULL DEFAULT (0), "can_view_reports" boolean NOT NULL DEFAULT (1), "last_login_at" datetime, CONSTRAINT "UQ_fe0bb3f6520ee0469504521e710" UNIQUE ("username"))`);
        await queryRunner.query(`CREATE UNIQUE INDEX "idx_users_username" ON "users" ("username") `);
        await queryRunner.query(`CREATE INDEX "idx_users_role" ON "users" ("role") `);
        await queryRunner.query(`CREATE INDEX "idx_users_is_active" ON "users" ("is_active") `);
        await queryRunner.query(`CREATE INDEX "idx_users_email" ON "users" ("email") `);
        await queryRunner.query(`CREATE INDEX "idx_users_employee_id" ON "users" ("employee_id") `);
        await queryRunner.query(`CREATE TABLE "inventory_transaction_logs" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "product_id" integer, "warehouse_id" varchar, "action" varchar(50) NOT NULL DEFAULT ('manual_adjustment'), "change_amount" integer NOT NULL, "quantity_before" integer NOT NULL, "quantity_after" integer NOT NULL, "price_before" integer, "price_after" integer, "reference_id" varchar, "reference_type" varchar(50), "performed_by_id" integer, "notes" text, "batch_number" varchar, "expiry_date" datetime, "created_at" datetime NOT NULL DEFAULT (CURRENT_TIMESTAMP), "ip_address" varchar, "user_agent" varchar)`);
        await queryRunner.query(`CREATE INDEX "idx_inventory_transaction_logs_created_at" ON "inventory_transaction_logs" ("created_at") `);
        await queryRunner.query(`CREATE INDEX "idx_inventory_transaction_logs_action" ON "inventory_transaction_logs" ("action") `);
        await queryRunner.query(`CREATE INDEX "idx_inventory_transaction_logs_product" ON "inventory_transaction_logs" ("product_id") `);
        await queryRunner.query(`CREATE INDEX "idx_inventory_transaction_logs_reference" ON "inventory_transaction_logs" ("reference_id", "reference_type") `);
        await queryRunner.query(`CREATE INDEX "idx_inventory_transaction_logs_user" ON "inventory_transaction_logs" ("performed_by_id") `);
        await queryRunner.query(`CREATE INDEX "idx_inventory_transaction_logs_date_action" ON "inventory_transaction_logs" ("created_at", "action") `);
        await queryRunner.query(`CREATE TABLE "price_history" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "product_id" integer NOT NULL, "old_price" integer NOT NULL, "new_price" integer NOT NULL, "change_type" varchar DEFAULT ('manual'), "change_reason" text, "effective_date" datetime NOT NULL DEFAULT (CURRENT_TIMESTAMP), "changed_by_id" integer, "reference_id" varchar, "reference_type" varchar, "created_at" datetime NOT NULL DEFAULT (datetime('now')))`);
        await queryRunner.query(`CREATE INDEX "IDX_ebdb4d54c8de7847c0f7a9e4fb" ON "price_history" ("product_id") `);
        await queryRunner.query(`CREATE INDEX "IDX_81bb91edf39554fae2d4067b4c" ON "price_history" ("effective_date") `);
        await queryRunner.query(`CREATE INDEX "IDX_2cc5a2c8f1e2da066d1903d058" ON "price_history" ("change_type") `);
        await queryRunner.query(`CREATE INDEX "IDX_1652c84026ff083cb79617c229" ON "price_history" ("product_id", "effective_date") `);
        await queryRunner.query(`CREATE TABLE "system_settings" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "key" varchar(100) NOT NULL, "value" text NOT NULL, "setting_type" varchar CHECK( "setting_type" IN ('general','email','users_roles','attendance','device','audit_security','user_security','notifications','data_reports','integrations','inventory_sync') ) NOT NULL, "description" text, "is_public" boolean NOT NULL DEFAULT (0), "is_deleted" boolean NOT NULL DEFAULT (0), "created_at" datetime NOT NULL DEFAULT (CURRENT_TIMESTAMP), "updated_at" datetime NOT NULL DEFAULT (CURRENT_TIMESTAMP))`);
        await queryRunner.query(`CREATE UNIQUE INDEX "idx_system_settings_type_key" ON "system_settings" ("setting_type", "key") `);
        await queryRunner.query(`CREATE TABLE "user_activities" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "user_id" integer NOT NULL, "action" varchar(100) NOT NULL, "entity" varchar(100), "entity_id" integer, "ip_address" varchar(45), "user_agent" varchar(255), "details" text, "created_at" datetime NOT NULL DEFAULT (CURRENT_TIMESTAMP))`);
        await queryRunner.query(`CREATE INDEX "idx_user_activity_user" ON "user_activities" ("user_id") `);
        await queryRunner.query(`CREATE INDEX "idx_user_activity_action" ON "user_activities" ("action") `);
        await queryRunner.query(`CREATE INDEX "idx_user_activity_entity" ON "user_activities" ("entity", "entity_id") `);
        await queryRunner.query(`CREATE TABLE "license_cache" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "license_key" text, "license_type" text NOT NULL, "status" text NOT NULL, "expires_at" datetime, "activated_at" datetime, "days_remaining" integer, "features" text DEFAULT ('[]'), "limits" text DEFAULT ('{}'), "usage" text DEFAULT ('{}'), "max_devices" integer NOT NULL DEFAULT (1), "current_devices" integer NOT NULL DEFAULT (0), "last_sync" datetime, "next_sync_due" datetime, "sync_interval_days" integer NOT NULL DEFAULT (30), "device_id" text, "activated_on_device" datetime, "server_response" text, "activation_id" text, "grace_period_days" integer NOT NULL DEFAULT (7), "server_timestamp" datetime, "offline_activation" boolean NOT NULL DEFAULT (0), "trial_consumed" boolean NOT NULL DEFAULT (0), "last_deactivated" datetime, "created_at" datetime NOT NULL DEFAULT (CURRENT_TIMESTAMP), "updated_at" datetime NOT NULL DEFAULT (CURRENT_TIMESTAMP), CONSTRAINT "UQ_e5240a5d083ab00fd7210838f5d" UNIQUE ("license_key"))`);
        await queryRunner.query(`CREATE INDEX "idx_license_key" ON "license_cache" ("license_key") `);
        await queryRunner.query(`CREATE INDEX "idx_expires_at" ON "license_cache" ("expires_at") `);
        await queryRunner.query(`CREATE INDEX "idx_next_sync" ON "license_cache" ("next_sync_due") `);
        await queryRunner.query(`CREATE INDEX "idx_license_status_expires" ON "license_cache" ("status", "expires_at") `);
        await queryRunner.query(`CREATE TABLE "customer_contacts" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "customer_id" integer NOT NULL, "contact_type" varchar NOT NULL DEFAULT ('primary'), "first_name" varchar, "last_name" varchar, "position" varchar, "email" varchar, "phone" varchar, "mobile" varchar, "is_default_contact" boolean NOT NULL DEFAULT (0), "receive_statements" boolean NOT NULL DEFAULT (1), "receive_marketing" boolean NOT NULL DEFAULT (1), "notes" text, "created_at" datetime NOT NULL DEFAULT (datetime('now')), "updated_at" datetime NOT NULL DEFAULT (datetime('now')))`);
        await queryRunner.query(`CREATE INDEX "idx_customer_contacts_customer_id" ON "customer_contacts" ("customer_id") `);
        await queryRunner.query(`CREATE INDEX "idx_customer_contacts_email" ON "customer_contacts" ("email") `);
        await queryRunner.query(`CREATE INDEX "idx_customer_contacts_is_default" ON "customer_contacts" ("is_default_contact") `);
        await queryRunner.query(`CREATE TABLE "customer_transactions" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "customer_id" integer NOT NULL, "transaction_type" varchar NOT NULL DEFAULT ('sale'), "transaction_date" datetime NOT NULL, "reference_id" varchar, "reference_type" varchar, "amount" decimal(10,2) NOT NULL, "balance_before" decimal(10,2) NOT NULL DEFAULT (0), "balance_after" decimal(10,2) NOT NULL DEFAULT (0), "description" text, "status" varchar NOT NULL DEFAULT ('completed'), "created_at" datetime NOT NULL DEFAULT (CURRENT_TIMESTAMP), "created_by" integer)`);
        await queryRunner.query(`CREATE INDEX "idx_customer_transactions_customer_id" ON "customer_transactions" ("customer_id") `);
        await queryRunner.query(`CREATE INDEX "idx_customer_transactions_type" ON "customer_transactions" ("transaction_type") `);
        await queryRunner.query(`CREATE INDEX "idx_customer_transactions_date" ON "customer_transactions" ("transaction_date") `);
        await queryRunner.query(`CREATE INDEX "idx_customer_transactions_status" ON "customer_transactions" ("status") `);
        await queryRunner.query(`CREATE TABLE "loyalty_programs" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "program_name" varchar NOT NULL, "program_description" text, "points_currency_name" varchar NOT NULL DEFAULT ('Points'), "points_per_currency" decimal(10,2) NOT NULL DEFAULT (1), "minimum_redemption_points" integer NOT NULL DEFAULT (100), "expiration_months" integer NOT NULL DEFAULT (12), "signup_bonus_points" integer NOT NULL DEFAULT (0), "birthday_bonus_points" integer NOT NULL DEFAULT (0), "anniversary_bonus_points" integer NOT NULL DEFAULT (0), "tier_requirements" text DEFAULT ('{"bronze":0,"silver":1000,"gold":5000,"platinum":20000}'), "tier_benefits" text DEFAULT ('{"bronze":["5% discount on all purchases"],"silver":["10% discount","Free shipping on orders over $100"],"gold":["15% discount","Free shipping","Priority support"],"platinum":["20% discount","Free shipping","VIP support","Early access to sales"]}'), "is_active" boolean NOT NULL DEFAULT (1), "created_at" datetime NOT NULL DEFAULT (CURRENT_TIMESTAMP), "updated_at" datetime NOT NULL DEFAULT (CURRENT_TIMESTAMP), "created_by" integer, "updated_by" integer)`);
        await queryRunner.query(`CREATE INDEX "idx_loyalty_programs_active" ON "loyalty_programs" ("is_active") `);
        await queryRunner.query(`CREATE INDEX "idx_loyalty_programs_created" ON "loyalty_programs" ("created_at") `);
        await queryRunner.query(`CREATE TABLE "loyalty_customers" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "customer_id" integer NOT NULL, "customer_code" varchar NOT NULL, "tier" varchar NOT NULL DEFAULT ('bronze'), "current_points" integer NOT NULL DEFAULT (0), "total_points_earned" integer NOT NULL DEFAULT (0), "total_points_redeemed" integer NOT NULL DEFAULT (0), "available_points" integer NOT NULL DEFAULT (0), "pending_points" integer NOT NULL DEFAULT (0), "points_expiring_soon" integer NOT NULL DEFAULT (0), "next_tier_points_needed" integer NOT NULL DEFAULT (0), "last_tier_upgrade" datetime, "membership_start_date" datetime NOT NULL DEFAULT (CURRENT_TIMESTAMP), "membership_end_date" datetime, "last_points_activity" datetime, "is_active" boolean NOT NULL DEFAULT (1), "enrollment_source" varchar, "receive_points_notifications" boolean NOT NULL DEFAULT (1), "receive_tier_notifications" boolean NOT NULL DEFAULT (1), "created_at" datetime NOT NULL DEFAULT (CURRENT_TIMESTAMP), "updated_at" datetime NOT NULL DEFAULT (CURRENT_TIMESTAMP), "created_by" integer, "updated_by" integer)`);
        await queryRunner.query(`CREATE UNIQUE INDEX "idx_loyalty_customers_customer" ON "loyalty_customers" ("customer_id") `);
        await queryRunner.query(`CREATE INDEX "idx_loyalty_customers_tier" ON "loyalty_customers" ("tier") `);
        await queryRunner.query(`CREATE INDEX "idx_loyalty_customers_active" ON "loyalty_customers" ("is_active") `);
        await queryRunner.query(`CREATE INDEX "idx_loyalty_customers_points" ON "loyalty_customers" ("available_points") `);
        await queryRunner.query(`CREATE TABLE "points_transactions" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "customer_id" integer NOT NULL, "loyalty_customer_id" integer NOT NULL, "transaction_type" varchar NOT NULL DEFAULT ('earn'), "points_amount" integer NOT NULL, "balance_before" integer NOT NULL, "balance_after" integer NOT NULL, "reference_type" varchar, "reference_id" integer, "reference_number" varchar, "description" varchar, "expiration_date" datetime, "status" varchar NOT NULL DEFAULT ('active'), "created_at" datetime NOT NULL DEFAULT (CURRENT_TIMESTAMP), "created_by" integer, "reversed_at" datetime, "reversed_by" integer, "reversal_reason" varchar)`);
        await queryRunner.query(`CREATE INDEX "idx_points_transactions_customer" ON "points_transactions" ("customer_id") `);
        await queryRunner.query(`CREATE INDEX "idx_points_transactions_type" ON "points_transactions" ("transaction_type") `);
        await queryRunner.query(`CREATE INDEX "idx_points_transactions_reference" ON "points_transactions" ("reference_type", "reference_id") `);
        await queryRunner.query(`CREATE INDEX "idx_points_transactions_created" ON "points_transactions" ("created_at") `);
        await queryRunner.query(`CREATE INDEX "idx_points_transactions_expiration" ON "points_transactions" ("expiration_date") `);
        await queryRunner.query(`CREATE TABLE "reward_items" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "reward_code" varchar NOT NULL, "reward_name" varchar NOT NULL, "description" text, "category" varchar NOT NULL DEFAULT ('discount'), "points_cost" integer NOT NULL, "cash_value" decimal(10,2), "discount_percentage" decimal(5,2), "stock_quantity" integer NOT NULL DEFAULT (-1), "max_redemptions_per_customer" integer NOT NULL DEFAULT (1), "total_redemptions" integer NOT NULL DEFAULT (0), "validity_period_days" integer NOT NULL DEFAULT (30), "valid_from" datetime, "valid_to" datetime, "product_id" integer, "product_quantity" integer NOT NULL DEFAULT (1), "is_active" boolean NOT NULL DEFAULT (1), "image_url" varchar, "terms_conditions" text, "eligible_tiers" text DEFAULT ('bronze,silver,gold,platinum'), "min_points_balance" integer NOT NULL DEFAULT (0), "created_at" datetime NOT NULL DEFAULT (CURRENT_TIMESTAMP), "updated_at" datetime NOT NULL DEFAULT (CURRENT_TIMESTAMP), "created_by" integer, "updated_by" integer, CONSTRAINT "UQ_a24691bdbdb2954bf9d872f54dc" UNIQUE ("reward_code"))`);
        await queryRunner.query(`CREATE UNIQUE INDEX "idx_reward_items_code" ON "reward_items" ("reward_code") `);
        await queryRunner.query(`CREATE INDEX "idx_reward_items_category" ON "reward_items" ("category") `);
        await queryRunner.query(`CREATE INDEX "idx_reward_items_active" ON "reward_items" ("is_active") `);
        await queryRunner.query(`CREATE INDEX "idx_reward_items_points" ON "reward_items" ("points_cost") `);
        await queryRunner.query(`CREATE TABLE "redemption_history" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "redemption_code" varchar NOT NULL, "customer_id" integer NOT NULL, "loyalty_customer_id" integer NOT NULL, "reward_id" integer NOT NULL, "reward_name" varchar NOT NULL, "points_cost" integer NOT NULL, "quantity" integer NOT NULL DEFAULT (1), "status" varchar NOT NULL DEFAULT ('pending'), "redemption_date" datetime NOT NULL DEFAULT (CURRENT_TIMESTAMP), "approval_date" datetime, "fulfillment_date" datetime, "expiration_date" datetime, "fulfillment_method" varchar, "tracking_number" varchar, "carrier" varchar, "shipping_address" text, "digital_delivery_code" varchar, "digital_delivery_expiry" datetime, "notes" text, "created_at" datetime NOT NULL DEFAULT (CURRENT_TIMESTAMP), "created_by" integer, "approved_by" integer, "fulfilled_by" integer, CONSTRAINT "UQ_60ecddee649b3911ef3024e607c" UNIQUE ("redemption_code"))`);
        await queryRunner.query(`CREATE UNIQUE INDEX "idx_redemption_history_code" ON "redemption_history" ("redemption_code") `);
        await queryRunner.query(`CREATE INDEX "idx_redemption_history_customer" ON "redemption_history" ("customer_id") `);
        await queryRunner.query(`CREATE INDEX "idx_redemption_history_reward" ON "redemption_history" ("reward_id") `);
        await queryRunner.query(`CREATE INDEX "idx_redemption_history_status" ON "redemption_history" ("status") `);
        await queryRunner.query(`CREATE INDEX "idx_redemption_history_date" ON "redemption_history" ("redemption_date") `);
        await queryRunner.query(`CREATE TABLE "points_earning_rules" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "rule_name" varchar NOT NULL, "rule_type" varchar NOT NULL DEFAULT ('purchase'), "points_multiplier" decimal(10,2) NOT NULL DEFAULT (1), "fixed_points" integer, "minimum_purchase" decimal(10,2), "maximum_points_per_transaction" integer, "applicable_categories" text, "applicable_products" text, "excluded_products" text, "applicable_tiers" text DEFAULT ('bronze,silver,gold,platinum'), "valid_days" text, "valid_period_start" datetime, "valid_period_end" datetime, "valid_time_start" time, "valid_time_end" time, "is_active" boolean NOT NULL DEFAULT (1), "priority" integer NOT NULL DEFAULT (1), "require_coupon_code" varchar, "max_uses_per_customer" integer, "created_at" datetime NOT NULL DEFAULT (CURRENT_TIMESTAMP), "updated_at" datetime NOT NULL DEFAULT (CURRENT_TIMESTAMP), "created_by" integer, "updated_by" integer)`);
        await queryRunner.query(`CREATE INDEX "idx_earning_rules_active" ON "points_earning_rules" ("is_active") `);
        await queryRunner.query(`CREATE INDEX "idx_earning_rules_type" ON "points_earning_rules" ("rule_type") `);
        await queryRunner.query(`CREATE INDEX "idx_earning_rules_priority" ON "points_earning_rules" ("priority") `);
        await queryRunner.query(`CREATE TABLE "customers" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "customer_code" varchar NOT NULL, "first_name" varchar, "last_name" varchar, "display_name" varchar, "email" varchar, "phone" varchar, "mobile" varchar, "address_line1" varchar, "address_line2" varchar, "city" varchar, "state" varchar, "postal_code" varchar, "country" varchar, "company_name" varchar, "tax_id" varchar, "customer_type" varchar NOT NULL DEFAULT ('individual'), "status" varchar NOT NULL DEFAULT ('active'), "credit_limit" decimal(10,2) NOT NULL DEFAULT (0), "current_balance" decimal(10,2) NOT NULL DEFAULT (0), "payment_terms" varchar, "preferred_payment_method" varchar, "customer_group" varchar, "customer_rating" integer NOT NULL DEFAULT (0), "notes" text, "tags" text, "allow_marketing_emails" boolean NOT NULL DEFAULT (1), "allow_sms_notifications" boolean NOT NULL DEFAULT (1), "created_at" datetime NOT NULL DEFAULT (datetime('now')), "updated_at" datetime NOT NULL DEFAULT (datetime('now')), "last_purchase_at" datetime, "created_by" integer, "updated_by" integer, CONSTRAINT "UQ_acd5656a9fa7cf04125f0848165" UNIQUE ("customer_code"))`);
        await queryRunner.query(`CREATE UNIQUE INDEX "idx_customers_customer_code" ON "customers" ("customer_code") `);
        await queryRunner.query(`CREATE INDEX "idx_customers_email" ON "customers" ("email") `);
        await queryRunner.query(`CREATE INDEX "idx_customers_phone" ON "customers" ("phone") `);
        await queryRunner.query(`CREATE INDEX "idx_customers_status" ON "customers" ("status") `);
        await queryRunner.query(`CREATE INDEX "idx_customers_customer_type" ON "customers" ("customer_type") `);
        await queryRunner.query(`CREATE INDEX "idx_customers_company_name" ON "customers" ("company_name") `);
        await queryRunner.query(`CREATE INDEX "idx_customers_last_purchase" ON "customers" ("last_purchase_at") `);
        await queryRunner.query(`CREATE TABLE "brands" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar NOT NULL, "description" text, "logo_url" varchar, "website" varchar, "is_active" boolean NOT NULL DEFAULT (1), "created_at" datetime NOT NULL DEFAULT (datetime('now')), "updated_at" datetime NOT NULL DEFAULT (datetime('now')))`);
        await queryRunner.query(`CREATE INDEX "idx_brands_name" ON "brands" ("name") `);
        await queryRunner.query(`CREATE TABLE "categories" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar NOT NULL, "description" text, "parent_id" integer, "sort_order" integer NOT NULL DEFAULT (0), "image_url" varchar, "is_active" boolean NOT NULL DEFAULT (1), "created_at" datetime NOT NULL DEFAULT (datetime('now')), "updated_at" datetime NOT NULL DEFAULT (datetime('now')))`);
        await queryRunner.query(`CREATE INDEX "idx_categories_name" ON "categories" ("name") `);
        await queryRunner.query(`CREATE INDEX "idx_categories_parent" ON "categories" ("parent_id") `);
        await queryRunner.query(`CREATE TABLE "product_variants" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "product_id" integer NOT NULL, "sku" varchar NOT NULL, "variant_name" varchar NOT NULL, "attributes" text, "price_adjustment" decimal(10,2) NOT NULL DEFAULT (0), "stock" integer NOT NULL DEFAULT (0), "barcode" varchar, "image_url" varchar, "is_active" boolean NOT NULL DEFAULT (1), "created_at" datetime NOT NULL DEFAULT (datetime('now')), "updated_at" datetime NOT NULL DEFAULT (datetime('now')), CONSTRAINT "UQ_46f236f21640f9da218a063a866" UNIQUE ("sku"), CONSTRAINT "UQ_62124a7ca2686cbaed42f0d3a29" UNIQUE ("barcode"))`);
        await queryRunner.query(`CREATE INDEX "idx_variants_product" ON "product_variants" ("product_id") `);
        await queryRunner.query(`CREATE UNIQUE INDEX "idx_variants_sku" ON "product_variants" ("sku") `);
        await queryRunner.query(`CREATE TABLE "suppliers" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "code" varchar NOT NULL, "name" varchar NOT NULL, "contact_person" varchar, "email" varchar, "phone" varchar, "address" text, "tax_id" varchar, "payment_terms" varchar, "is_active" boolean NOT NULL DEFAULT (1), "notes" text, "created_at" datetime NOT NULL DEFAULT (datetime('now')), "updated_at" datetime NOT NULL DEFAULT (datetime('now')), CONSTRAINT "UQ_6f01a03dcb1aa33822e19534cd6" UNIQUE ("code"))`);
        await queryRunner.query(`CREATE UNIQUE INDEX "idx_suppliers_code" ON "suppliers" ("code") `);
        await queryRunner.query(`CREATE INDEX "idx_suppliers_name" ON "suppliers" ("name") `);
        await queryRunner.query(`DROP INDEX "idx_sales_datetime"`);
        await queryRunner.query(`DROP INDEX "idx_sales_status"`);
        await queryRunner.query(`DROP INDEX "idx_sales_reference_number"`);
        await queryRunner.query(`DROP INDEX "idx_sales_warehouse"`);
        await queryRunner.query(`DROP INDEX "idx_sales_customer"`);
        await queryRunner.query(`DROP INDEX "idx_sales_inventory_synced"`);
        await queryRunner.query(`CREATE TABLE "temporary_sales" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "datetime" datetime NOT NULL DEFAULT (CURRENT_TIMESTAMP), "total" integer NOT NULL, "warehouse_id" varchar, "warehouse_name" varchar, "customer_id" integer, "customer_name" varchar, "customer_phone" varchar, "customer_email" varchar, "subtotal" integer NOT NULL DEFAULT (0), "discount_amount" integer NOT NULL DEFAULT (0), "tax_amount" integer NOT NULL DEFAULT (0), "payment_method" varchar NOT NULL DEFAULT ('cash'), "status" varchar NOT NULL DEFAULT ('completed'), "reference_number" varchar, "inventory_synced" boolean NOT NULL DEFAULT (0), "inventory_sync_date" datetime, "user_id" integer, "user_name" varchar, "notes" text, "created_at" datetime NOT NULL DEFAULT (datetime('now')), "updated_at" datetime NOT NULL DEFAULT (datetime('now')), CONSTRAINT "UQ_7eda0726704e0f1258eeb58ab4a" UNIQUE ("reference_number"), CONSTRAINT "FK_5f282f3656814ec9ca2675aef6f" FOREIGN KEY ("user_id") REFERENCES "users" ("id") ON DELETE SET NULL ON UPDATE NO ACTION, CONSTRAINT "FK_c51005b2b06cec7aa17462c54f5" FOREIGN KEY ("customer_id") REFERENCES "customers" ("id") ON DELETE SET NULL ON UPDATE NO ACTION)`);
        await queryRunner.query(`INSERT INTO "temporary_sales"("id", "datetime", "total", "warehouse_id", "warehouse_name", "customer_id", "customer_name", "customer_phone", "customer_email", "subtotal", "discount_amount", "tax_amount", "payment_method", "status", "reference_number", "inventory_synced", "inventory_sync_date", "user_id", "user_name", "notes", "created_at", "updated_at") SELECT "id", "datetime", "total", "warehouse_id", "warehouse_name", "customer_id", "customer_name", "customer_phone", "customer_email", "subtotal", "discount_amount", "tax_amount", "payment_method", "status", "reference_number", "inventory_synced", "inventory_sync_date", "user_id", "user_name", "notes", "created_at", "updated_at" FROM "sales"`);
        await queryRunner.query(`DROP TABLE "sales"`);
        await queryRunner.query(`ALTER TABLE "temporary_sales" RENAME TO "sales"`);
        await queryRunner.query(`CREATE INDEX "idx_sales_datetime" ON "sales" ("datetime") `);
        await queryRunner.query(`CREATE INDEX "idx_sales_status" ON "sales" ("status") `);
        await queryRunner.query(`CREATE INDEX "idx_sales_reference_number" ON "sales" ("reference_number") `);
        await queryRunner.query(`CREATE INDEX "idx_sales_warehouse" ON "sales" ("warehouse_id") `);
        await queryRunner.query(`CREATE INDEX "idx_sales_customer" ON "sales" ("customer_id") `);
        await queryRunner.query(`CREATE INDEX "idx_sales_inventory_synced" ON "sales" ("inventory_synced") `);
        await queryRunner.query(`DROP INDEX "idx_sale_items_sale_id"`);
        await queryRunner.query(`DROP INDEX "idx_sale_items_product_id"`);
        await queryRunner.query(`DROP INDEX "idx_sale_items_is_returned"`);
        await queryRunner.query(`DROP INDEX "idx_sale_items_sync_id"`);
        await queryRunner.query(`DROP INDEX "idx_sale_items_inventory_synced"`);
        await queryRunner.query(`CREATE TABLE "temporary_sale_items" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "sale_id" integer NOT NULL, "product_id" integer NOT NULL, "warehouse_id" varchar, "sync_id" varchar, "inventory_synced" boolean NOT NULL DEFAULT (0), "product_name" varchar NOT NULL, "product_barcode" varchar, "product_sku" varchar, "is_variant" boolean NOT NULL DEFAULT (0), "variant_name" varchar, "quantity" integer NOT NULL, "unit_price" integer NOT NULL, "total_price" integer NOT NULL, "cost_price" integer, "profit" integer, "discount_percentage" decimal(5,2) NOT NULL DEFAULT (0), "discount_amount" integer NOT NULL DEFAULT (0), "price_before_discount" integer, "returned_quantity" integer NOT NULL DEFAULT (0), "is_returned" boolean NOT NULL DEFAULT (0), "return_reason" varchar, "return_date" datetime, "created_at" datetime NOT NULL DEFAULT (datetime('now')), "updated_at" datetime NOT NULL DEFAULT (datetime('now')), CONSTRAINT "FK_c210a330b80232c29c2ad68462a" FOREIGN KEY ("sale_id") REFERENCES "sales" ("id") ON DELETE CASCADE ON UPDATE NO ACTION, CONSTRAINT "FK_4ecae62db3f9e9cc9a368d57adb" FOREIGN KEY ("product_id") REFERENCES "products" ("id") ON DELETE SET NULL ON UPDATE NO ACTION)`);
        await queryRunner.query(`INSERT INTO "temporary_sale_items"("id", "sale_id", "product_id", "warehouse_id", "sync_id", "inventory_synced", "product_name", "product_barcode", "product_sku", "is_variant", "variant_name", "quantity", "unit_price", "total_price", "cost_price", "profit", "discount_percentage", "discount_amount", "price_before_discount", "returned_quantity", "is_returned", "return_reason", "return_date", "created_at", "updated_at") SELECT "id", "sale_id", "product_id", "warehouse_id", "sync_id", "inventory_synced", "product_name", "product_barcode", "product_sku", "is_variant", "variant_name", "quantity", "unit_price", "total_price", "cost_price", "profit", "discount_percentage", "discount_amount", "price_before_discount", "returned_quantity", "is_returned", "return_reason", "return_date", "created_at", "updated_at" FROM "sale_items"`);
        await queryRunner.query(`DROP TABLE "sale_items"`);
        await queryRunner.query(`ALTER TABLE "temporary_sale_items" RENAME TO "sale_items"`);
        await queryRunner.query(`CREATE INDEX "idx_sale_items_sale_id" ON "sale_items" ("sale_id") `);
        await queryRunner.query(`CREATE INDEX "idx_sale_items_product_id" ON "sale_items" ("product_id") `);
        await queryRunner.query(`CREATE INDEX "idx_sale_items_is_returned" ON "sale_items" ("is_returned") `);
        await queryRunner.query(`CREATE INDEX "idx_sale_items_sync_id" ON "sale_items" ("sync_id") `);
        await queryRunner.query(`CREATE INDEX "idx_sale_items_inventory_synced" ON "sale_items" ("inventory_synced") `);
        await queryRunner.query(`DROP INDEX "idx_products_sku"`);
        await queryRunner.query(`DROP INDEX "idx_products_barcode"`);
        await queryRunner.query(`DROP INDEX "idx_products_name"`);
        await queryRunner.query(`DROP INDEX "idx_products_status"`);
        await queryRunner.query(`DROP INDEX "idx_products_category"`);
        await queryRunner.query(`DROP INDEX "idx_products_supplier"`);
        await queryRunner.query(`DROP INDEX "idx_products_stock"`);
        await queryRunner.query(`DROP INDEX "idx_products_active"`);
        await queryRunner.query(`DROP INDEX "idx_products_price"`);
        await queryRunner.query(`DROP INDEX "idx_products_pos_quick_code"`);
        await queryRunner.query(`DROP INDEX "idx_products_type"`);
        await queryRunner.query(`DROP INDEX "idx_products_created"`);
        await queryRunner.query(`DROP INDEX "idx_products_sku_name"`);
        await queryRunner.query(`DROP INDEX "idx_products_supplier_sku"`);
        await queryRunner.query(`DROP INDEX "idx_products_total_sold"`);
        await queryRunner.query(`DROP INDEX "idx_products_is_deleted"`);
        await queryRunner.query(`CREATE TABLE "temporary_products" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "sku" varchar(100) NOT NULL, "barcode" varchar(100), "upc" varchar(50), "name" varchar(255) NOT NULL, "display_name" varchar(255), "description" text, "product_type" varchar NOT NULL DEFAULT ('simple'), "category_id" integer, "subcategory_id" integer, "brand_id" integer, "cost_price" decimal(12,2), "selling_price" decimal(12,2) NOT NULL, "wholesale_price" decimal(12,2), "min_price" decimal(12,2), "max_price" decimal(12,2), "markup_percentage" decimal(5,2), "stock" integer NOT NULL DEFAULT (0), "reserved_stock" integer NOT NULL DEFAULT (0), "available_stock" integer NOT NULL DEFAULT (0), "min_stock_level" integer NOT NULL DEFAULT (5), "max_stock_level" integer, "reorder_level" integer NOT NULL DEFAULT (10), "tax_rate" decimal(5,2) NOT NULL DEFAULT (0), "tax_type" varchar NOT NULL DEFAULT ('exclusive'), "is_taxable" boolean NOT NULL DEFAULT (1), "discount_percentage" decimal(5,2) NOT NULL DEFAULT (0), "discount_amount" decimal(10,2) NOT NULL DEFAULT (0), "weight" decimal(10,2), "weight_unit" varchar NOT NULL DEFAULT ('kg'), "length" decimal(10,2), "width" decimal(10,2), "height" decimal(10,2), "dimension_unit" varchar NOT NULL DEFAULT ('cm'), "supplier_id" integer, "supplier_sku" varchar, "supplier_price" decimal(12,2), "lead_time_days" integer NOT NULL DEFAULT (7), "has_expiry" boolean NOT NULL DEFAULT (0), "shelf_life_days" integer, "track_batch" boolean NOT NULL DEFAULT (0), "track_serial" boolean NOT NULL DEFAULT (0), "image_url" varchar, "image_urls" text, "thumbnail_url" varchar, "pos_quick_code" varchar, "pos_category_id" integer, "is_quick_sale" boolean NOT NULL DEFAULT (0), "is_hidden" boolean NOT NULL DEFAULT (0), "kitchen_printer_id" integer, "preparation_time" integer NOT NULL DEFAULT (0), "loyalty_points_earn" integer NOT NULL DEFAULT (0), "is_reward_product" boolean NOT NULL DEFAULT (0), "reward_points_cost" integer NOT NULL DEFAULT (0), "status" varchar NOT NULL DEFAULT ('active'), "is_active" boolean NOT NULL DEFAULT (1), "is_deleted" boolean NOT NULL DEFAULT (0), "is_bestseller" boolean NOT NULL DEFAULT (0), "is_featured" boolean NOT NULL DEFAULT (0), "is_new" boolean NOT NULL DEFAULT (1), "tags" text, "attributes" text, "specifications" text, "created_at" datetime NOT NULL DEFAULT (CURRENT_TIMESTAMP), "updated_at" datetime NOT NULL DEFAULT (CURRENT_TIMESTAMP), "deleted_at" datetime, "last_sold_at" datetime, "last_received_at" datetime, "created_by" integer, "updated_by" integer, "deleted_by" integer, "total_sold" integer NOT NULL DEFAULT (0), "total_returned" integer NOT NULL DEFAULT (0), "total_profit" decimal(12,2) NOT NULL DEFAULT (0), "average_rating" decimal(3,2) NOT NULL DEFAULT (0), "review_count" integer NOT NULL DEFAULT (0), CONSTRAINT "UQ_c44ac33a05b144dd0d9ddcf9327" UNIQUE ("sku"), CONSTRAINT "UQ_adfc522baf9d9b19cd7d9461b7e" UNIQUE ("barcode"), CONSTRAINT "FK_9a5f6868c96e0069e699f33e124" FOREIGN KEY ("category_id") REFERENCES "categories" ("id") ON DELETE NO ACTION ON UPDATE NO ACTION, CONSTRAINT "FK_1530a6f15d3c79d1b70be98f2be" FOREIGN KEY ("brand_id") REFERENCES "brands" ("id") ON DELETE NO ACTION ON UPDATE NO ACTION, CONSTRAINT "FK_0ec433c1e1d444962d592d86c86" FOREIGN KEY ("supplier_id") REFERENCES "suppliers" ("id") ON DELETE NO ACTION ON UPDATE NO ACTION, CONSTRAINT "FK_c1af9b47239151e255f62e03247" FOREIGN KEY ("created_by") REFERENCES "users" ("id") ON DELETE NO ACTION ON UPDATE NO ACTION, CONSTRAINT "FK_4b9f1600a4f721ac017eefb03ee" FOREIGN KEY ("updated_by") REFERENCES "users" ("id") ON DELETE NO ACTION ON UPDATE NO ACTION, CONSTRAINT "FK_0806c755e0aca124e67c0cf6d7d" FOREIGN KEY ("id") REFERENCES "reward_items" ("id") ON DELETE NO ACTION ON UPDATE NO ACTION)`);
        await queryRunner.query(`INSERT INTO "temporary_products"("id", "sku", "barcode", "upc", "name", "display_name", "description", "product_type", "category_id", "subcategory_id", "brand_id", "cost_price", "selling_price", "wholesale_price", "min_price", "max_price", "markup_percentage", "stock", "reserved_stock", "available_stock", "min_stock_level", "max_stock_level", "reorder_level", "tax_rate", "tax_type", "is_taxable", "discount_percentage", "discount_amount", "weight", "weight_unit", "length", "width", "height", "dimension_unit", "supplier_id", "supplier_sku", "supplier_price", "lead_time_days", "has_expiry", "shelf_life_days", "track_batch", "track_serial", "image_url", "image_urls", "thumbnail_url", "pos_quick_code", "pos_category_id", "is_quick_sale", "is_hidden", "kitchen_printer_id", "preparation_time", "loyalty_points_earn", "is_reward_product", "reward_points_cost", "status", "is_active", "is_deleted", "is_bestseller", "is_featured", "is_new", "tags", "attributes", "specifications", "created_at", "updated_at", "deleted_at", "last_sold_at", "last_received_at", "created_by", "updated_by", "deleted_by", "total_sold", "total_returned", "total_profit", "average_rating", "review_count") SELECT "id", "sku", "barcode", "upc", "name", "display_name", "description", "product_type", "category_id", "subcategory_id", "brand_id", "cost_price", "selling_price", "wholesale_price", "min_price", "max_price", "markup_percentage", "stock", "reserved_stock", "available_stock", "min_stock_level", "max_stock_level", "reorder_level", "tax_rate", "tax_type", "is_taxable", "discount_percentage", "discount_amount", "weight", "weight_unit", "length", "width", "height", "dimension_unit", "supplier_id", "supplier_sku", "supplier_price", "lead_time_days", "has_expiry", "shelf_life_days", "track_batch", "track_serial", "image_url", "image_urls", "thumbnail_url", "pos_quick_code", "pos_category_id", "is_quick_sale", "is_hidden", "kitchen_printer_id", "preparation_time", "loyalty_points_earn", "is_reward_product", "reward_points_cost", "status", "is_active", "is_deleted", "is_bestseller", "is_featured", "is_new", "tags", "attributes", "specifications", "created_at", "updated_at", "deleted_at", "last_sold_at", "last_received_at", "created_by", "updated_by", "deleted_by", "total_sold", "total_returned", "total_profit", "average_rating", "review_count" FROM "products"`);
        await queryRunner.query(`DROP TABLE "products"`);
        await queryRunner.query(`ALTER TABLE "temporary_products" RENAME TO "products"`);
        await queryRunner.query(`CREATE UNIQUE INDEX "idx_products_sku" ON "products" ("sku") `);
        await queryRunner.query(`CREATE UNIQUE INDEX "idx_products_barcode" ON "products" ("barcode") `);
        await queryRunner.query(`CREATE INDEX "idx_products_name" ON "products" ("name") `);
        await queryRunner.query(`CREATE INDEX "idx_products_status" ON "products" ("status") `);
        await queryRunner.query(`CREATE INDEX "idx_products_category" ON "products" ("category_id") `);
        await queryRunner.query(`CREATE INDEX "idx_products_supplier" ON "products" ("supplier_id") `);
        await queryRunner.query(`CREATE INDEX "idx_products_stock" ON "products" ("stock") `);
        await queryRunner.query(`CREATE INDEX "idx_products_active" ON "products" ("is_active") `);
        await queryRunner.query(`CREATE INDEX "idx_products_price" ON "products" ("selling_price") `);
        await queryRunner.query(`CREATE INDEX "idx_products_pos_quick_code" ON "products" ("pos_quick_code") `);
        await queryRunner.query(`CREATE INDEX "idx_products_type" ON "products" ("product_type") `);
        await queryRunner.query(`CREATE INDEX "idx_products_created" ON "products" ("created_at") `);
        await queryRunner.query(`CREATE INDEX "idx_products_sku_name" ON "products" ("sku", "name") `);
        await queryRunner.query(`CREATE INDEX "idx_products_supplier_sku" ON "products" ("supplier_sku") `);
        await queryRunner.query(`CREATE INDEX "idx_products_total_sold" ON "products" ("total_sold") `);
        await queryRunner.query(`CREATE INDEX "idx_products_is_deleted" ON "products" ("is_deleted") `);
        await queryRunner.query(`DROP INDEX "idx_audit_entity"`);
        await queryRunner.query(`DROP INDEX "idx_audit_user"`);
        await queryRunner.query(`DROP INDEX "idx_audit_action_time"`);
        await queryRunner.query(`CREATE TABLE "temporary_audit_trails" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "action" varchar(100) NOT NULL, "entity" varchar(100) NOT NULL, "entity_id" integer NOT NULL, "details" text, "timestamp" datetime NOT NULL DEFAULT (CURRENT_TIMESTAMP), "user_id" integer NOT NULL, CONSTRAINT "FK_ed8d9979a8295afe3a06fb5d82a" FOREIGN KEY ("user_id") REFERENCES "users" ("id") ON DELETE CASCADE ON UPDATE NO ACTION)`);
        await queryRunner.query(`INSERT INTO "temporary_audit_trails"("id", "action", "entity", "entity_id", "details", "timestamp", "user_id") SELECT "id", "action", "entity", "entity_id", "details", "timestamp", "user_id" FROM "audit_trails"`);
        await queryRunner.query(`DROP TABLE "audit_trails"`);
        await queryRunner.query(`ALTER TABLE "temporary_audit_trails" RENAME TO "audit_trails"`);
        await queryRunner.query(`CREATE INDEX "idx_audit_entity" ON "audit_trails" ("entity", "entity_id") `);
        await queryRunner.query(`CREATE INDEX "idx_audit_user" ON "audit_trails" ("user_id") `);
        await queryRunner.query(`CREATE INDEX "idx_audit_action_time" ON "audit_trails" ("action", "timestamp") `);
        await queryRunner.query(`DROP INDEX "idx_inventory_transaction_logs_created_at"`);
        await queryRunner.query(`DROP INDEX "idx_inventory_transaction_logs_action"`);
        await queryRunner.query(`DROP INDEX "idx_inventory_transaction_logs_product"`);
        await queryRunner.query(`DROP INDEX "idx_inventory_transaction_logs_reference"`);
        await queryRunner.query(`DROP INDEX "idx_inventory_transaction_logs_user"`);
        await queryRunner.query(`DROP INDEX "idx_inventory_transaction_logs_date_action"`);
        await queryRunner.query(`CREATE TABLE "temporary_inventory_transaction_logs" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "product_id" integer, "warehouse_id" varchar, "action" varchar(50) NOT NULL DEFAULT ('manual_adjustment'), "change_amount" integer NOT NULL, "quantity_before" integer NOT NULL, "quantity_after" integer NOT NULL, "price_before" integer, "price_after" integer, "reference_id" varchar, "reference_type" varchar(50), "performed_by_id" integer, "notes" text, "batch_number" varchar, "expiry_date" datetime, "created_at" datetime NOT NULL DEFAULT (CURRENT_TIMESTAMP), "ip_address" varchar, "user_agent" varchar, CONSTRAINT "FK_413b26dad65a59a9b282a3120d8" FOREIGN KEY ("product_id") REFERENCES "products" ("id") ON DELETE CASCADE ON UPDATE NO ACTION, CONSTRAINT "FK_808f2a1c594e3ffcf916e269764" FOREIGN KEY ("performed_by_id") REFERENCES "users" ("id") ON DELETE SET NULL ON UPDATE NO ACTION)`);
        await queryRunner.query(`INSERT INTO "temporary_inventory_transaction_logs"("id", "product_id", "warehouse_id", "action", "change_amount", "quantity_before", "quantity_after", "price_before", "price_after", "reference_id", "reference_type", "performed_by_id", "notes", "batch_number", "expiry_date", "created_at", "ip_address", "user_agent") SELECT "id", "product_id", "warehouse_id", "action", "change_amount", "quantity_before", "quantity_after", "price_before", "price_after", "reference_id", "reference_type", "performed_by_id", "notes", "batch_number", "expiry_date", "created_at", "ip_address", "user_agent" FROM "inventory_transaction_logs"`);
        await queryRunner.query(`DROP TABLE "inventory_transaction_logs"`);
        await queryRunner.query(`ALTER TABLE "temporary_inventory_transaction_logs" RENAME TO "inventory_transaction_logs"`);
        await queryRunner.query(`CREATE INDEX "idx_inventory_transaction_logs_created_at" ON "inventory_transaction_logs" ("created_at") `);
        await queryRunner.query(`CREATE INDEX "idx_inventory_transaction_logs_action" ON "inventory_transaction_logs" ("action") `);
        await queryRunner.query(`CREATE INDEX "idx_inventory_transaction_logs_product" ON "inventory_transaction_logs" ("product_id") `);
        await queryRunner.query(`CREATE INDEX "idx_inventory_transaction_logs_reference" ON "inventory_transaction_logs" ("reference_id", "reference_type") `);
        await queryRunner.query(`CREATE INDEX "idx_inventory_transaction_logs_user" ON "inventory_transaction_logs" ("performed_by_id") `);
        await queryRunner.query(`CREATE INDEX "idx_inventory_transaction_logs_date_action" ON "inventory_transaction_logs" ("created_at", "action") `);
        await queryRunner.query(`DROP INDEX "IDX_ebdb4d54c8de7847c0f7a9e4fb"`);
        await queryRunner.query(`DROP INDEX "IDX_81bb91edf39554fae2d4067b4c"`);
        await queryRunner.query(`DROP INDEX "IDX_2cc5a2c8f1e2da066d1903d058"`);
        await queryRunner.query(`DROP INDEX "IDX_1652c84026ff083cb79617c229"`);
        await queryRunner.query(`CREATE TABLE "temporary_price_history" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "product_id" integer NOT NULL, "old_price" integer NOT NULL, "new_price" integer NOT NULL, "change_type" varchar DEFAULT ('manual'), "change_reason" text, "effective_date" datetime NOT NULL DEFAULT (CURRENT_TIMESTAMP), "changed_by_id" integer, "reference_id" varchar, "reference_type" varchar, "created_at" datetime NOT NULL DEFAULT (datetime('now')), CONSTRAINT "FK_ebdb4d54c8de7847c0f7a9e4fbb" FOREIGN KEY ("product_id") REFERENCES "products" ("id") ON DELETE CASCADE ON UPDATE NO ACTION, CONSTRAINT "FK_34d939d6f2c6c4136aacbd09ffc" FOREIGN KEY ("changed_by_id") REFERENCES "users" ("id") ON DELETE SET NULL ON UPDATE NO ACTION)`);
        await queryRunner.query(`INSERT INTO "temporary_price_history"("id", "product_id", "old_price", "new_price", "change_type", "change_reason", "effective_date", "changed_by_id", "reference_id", "reference_type", "created_at") SELECT "id", "product_id", "old_price", "new_price", "change_type", "change_reason", "effective_date", "changed_by_id", "reference_id", "reference_type", "created_at" FROM "price_history"`);
        await queryRunner.query(`DROP TABLE "price_history"`);
        await queryRunner.query(`ALTER TABLE "temporary_price_history" RENAME TO "price_history"`);
        await queryRunner.query(`CREATE INDEX "IDX_ebdb4d54c8de7847c0f7a9e4fb" ON "price_history" ("product_id") `);
        await queryRunner.query(`CREATE INDEX "IDX_81bb91edf39554fae2d4067b4c" ON "price_history" ("effective_date") `);
        await queryRunner.query(`CREATE INDEX "IDX_2cc5a2c8f1e2da066d1903d058" ON "price_history" ("change_type") `);
        await queryRunner.query(`CREATE INDEX "IDX_1652c84026ff083cb79617c229" ON "price_history" ("product_id", "effective_date") `);
        await queryRunner.query(`DROP INDEX "idx_user_activity_user"`);
        await queryRunner.query(`DROP INDEX "idx_user_activity_action"`);
        await queryRunner.query(`DROP INDEX "idx_user_activity_entity"`);
        await queryRunner.query(`CREATE TABLE "temporary_user_activities" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "user_id" integer NOT NULL, "action" varchar(100) NOT NULL, "entity" varchar(100), "entity_id" integer, "ip_address" varchar(45), "user_agent" varchar(255), "details" text, "created_at" datetime NOT NULL DEFAULT (CURRENT_TIMESTAMP), CONSTRAINT "FK_a283f37e08edf5e37d38b375eec" FOREIGN KEY ("user_id") REFERENCES "users" ("id") ON DELETE CASCADE ON UPDATE NO ACTION)`);
        await queryRunner.query(`INSERT INTO "temporary_user_activities"("id", "user_id", "action", "entity", "entity_id", "ip_address", "user_agent", "details", "created_at") SELECT "id", "user_id", "action", "entity", "entity_id", "ip_address", "user_agent", "details", "created_at" FROM "user_activities"`);
        await queryRunner.query(`DROP TABLE "user_activities"`);
        await queryRunner.query(`ALTER TABLE "temporary_user_activities" RENAME TO "user_activities"`);
        await queryRunner.query(`CREATE INDEX "idx_user_activity_user" ON "user_activities" ("user_id") `);
        await queryRunner.query(`CREATE INDEX "idx_user_activity_action" ON "user_activities" ("action") `);
        await queryRunner.query(`CREATE INDEX "idx_user_activity_entity" ON "user_activities" ("entity", "entity_id") `);
        await queryRunner.query(`DROP INDEX "idx_customer_contacts_customer_id"`);
        await queryRunner.query(`DROP INDEX "idx_customer_contacts_email"`);
        await queryRunner.query(`DROP INDEX "idx_customer_contacts_is_default"`);
        await queryRunner.query(`CREATE TABLE "temporary_customer_contacts" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "customer_id" integer NOT NULL, "contact_type" varchar NOT NULL DEFAULT ('primary'), "first_name" varchar, "last_name" varchar, "position" varchar, "email" varchar, "phone" varchar, "mobile" varchar, "is_default_contact" boolean NOT NULL DEFAULT (0), "receive_statements" boolean NOT NULL DEFAULT (1), "receive_marketing" boolean NOT NULL DEFAULT (1), "notes" text, "created_at" datetime NOT NULL DEFAULT (datetime('now')), "updated_at" datetime NOT NULL DEFAULT (datetime('now')), CONSTRAINT "FK_76ca61fed7339b9f358599f9fda" FOREIGN KEY ("customer_id") REFERENCES "customers" ("id") ON DELETE NO ACTION ON UPDATE NO ACTION)`);
        await queryRunner.query(`INSERT INTO "temporary_customer_contacts"("id", "customer_id", "contact_type", "first_name", "last_name", "position", "email", "phone", "mobile", "is_default_contact", "receive_statements", "receive_marketing", "notes", "created_at", "updated_at") SELECT "id", "customer_id", "contact_type", "first_name", "last_name", "position", "email", "phone", "mobile", "is_default_contact", "receive_statements", "receive_marketing", "notes", "created_at", "updated_at" FROM "customer_contacts"`);
        await queryRunner.query(`DROP TABLE "customer_contacts"`);
        await queryRunner.query(`ALTER TABLE "temporary_customer_contacts" RENAME TO "customer_contacts"`);
        await queryRunner.query(`CREATE INDEX "idx_customer_contacts_customer_id" ON "customer_contacts" ("customer_id") `);
        await queryRunner.query(`CREATE INDEX "idx_customer_contacts_email" ON "customer_contacts" ("email") `);
        await queryRunner.query(`CREATE INDEX "idx_customer_contacts_is_default" ON "customer_contacts" ("is_default_contact") `);
        await queryRunner.query(`DROP INDEX "idx_customer_transactions_customer_id"`);
        await queryRunner.query(`DROP INDEX "idx_customer_transactions_type"`);
        await queryRunner.query(`DROP INDEX "idx_customer_transactions_date"`);
        await queryRunner.query(`DROP INDEX "idx_customer_transactions_status"`);
        await queryRunner.query(`CREATE TABLE "temporary_customer_transactions" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "customer_id" integer NOT NULL, "transaction_type" varchar NOT NULL DEFAULT ('sale'), "transaction_date" datetime NOT NULL, "reference_id" varchar, "reference_type" varchar, "amount" decimal(10,2) NOT NULL, "balance_before" decimal(10,2) NOT NULL DEFAULT (0), "balance_after" decimal(10,2) NOT NULL DEFAULT (0), "description" text, "status" varchar NOT NULL DEFAULT ('completed'), "created_at" datetime NOT NULL DEFAULT (CURRENT_TIMESTAMP), "created_by" integer, CONSTRAINT "FK_d8d72772d17f6e215d76467e291" FOREIGN KEY ("customer_id") REFERENCES "customers" ("id") ON DELETE NO ACTION ON UPDATE NO ACTION, CONSTRAINT "FK_a5db0c373468605c5d637628ac0" FOREIGN KEY ("created_by") REFERENCES "users" ("id") ON DELETE NO ACTION ON UPDATE NO ACTION)`);
        await queryRunner.query(`INSERT INTO "temporary_customer_transactions"("id", "customer_id", "transaction_type", "transaction_date", "reference_id", "reference_type", "amount", "balance_before", "balance_after", "description", "status", "created_at", "created_by") SELECT "id", "customer_id", "transaction_type", "transaction_date", "reference_id", "reference_type", "amount", "balance_before", "balance_after", "description", "status", "created_at", "created_by" FROM "customer_transactions"`);
        await queryRunner.query(`DROP TABLE "customer_transactions"`);
        await queryRunner.query(`ALTER TABLE "temporary_customer_transactions" RENAME TO "customer_transactions"`);
        await queryRunner.query(`CREATE INDEX "idx_customer_transactions_customer_id" ON "customer_transactions" ("customer_id") `);
        await queryRunner.query(`CREATE INDEX "idx_customer_transactions_type" ON "customer_transactions" ("transaction_type") `);
        await queryRunner.query(`CREATE INDEX "idx_customer_transactions_date" ON "customer_transactions" ("transaction_date") `);
        await queryRunner.query(`CREATE INDEX "idx_customer_transactions_status" ON "customer_transactions" ("status") `);
        await queryRunner.query(`DROP INDEX "idx_loyalty_programs_active"`);
        await queryRunner.query(`DROP INDEX "idx_loyalty_programs_created"`);
        await queryRunner.query(`CREATE TABLE "temporary_loyalty_programs" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "program_name" varchar NOT NULL, "program_description" text, "points_currency_name" varchar NOT NULL DEFAULT ('Points'), "points_per_currency" decimal(10,2) NOT NULL DEFAULT (1), "minimum_redemption_points" integer NOT NULL DEFAULT (100), "expiration_months" integer NOT NULL DEFAULT (12), "signup_bonus_points" integer NOT NULL DEFAULT (0), "birthday_bonus_points" integer NOT NULL DEFAULT (0), "anniversary_bonus_points" integer NOT NULL DEFAULT (0), "tier_requirements" text DEFAULT ('{"bronze":0,"silver":1000,"gold":5000,"platinum":20000}'), "tier_benefits" text DEFAULT ('{"bronze":["5% discount on all purchases"],"silver":["10% discount","Free shipping on orders over $100"],"gold":["15% discount","Free shipping","Priority support"],"platinum":["20% discount","Free shipping","VIP support","Early access to sales"]}'), "is_active" boolean NOT NULL DEFAULT (1), "created_at" datetime NOT NULL DEFAULT (CURRENT_TIMESTAMP), "updated_at" datetime NOT NULL DEFAULT (CURRENT_TIMESTAMP), "created_by" integer, "updated_by" integer, CONSTRAINT "FK_c0a455b4e20eb8e7934083e711e" FOREIGN KEY ("created_by") REFERENCES "users" ("id") ON DELETE NO ACTION ON UPDATE NO ACTION, CONSTRAINT "FK_8453c298074d5b5b6e72e851758" FOREIGN KEY ("updated_by") REFERENCES "users" ("id") ON DELETE NO ACTION ON UPDATE NO ACTION)`);
        await queryRunner.query(`INSERT INTO "temporary_loyalty_programs"("id", "program_name", "program_description", "points_currency_name", "points_per_currency", "minimum_redemption_points", "expiration_months", "signup_bonus_points", "birthday_bonus_points", "anniversary_bonus_points", "tier_requirements", "tier_benefits", "is_active", "created_at", "updated_at", "created_by", "updated_by") SELECT "id", "program_name", "program_description", "points_currency_name", "points_per_currency", "minimum_redemption_points", "expiration_months", "signup_bonus_points", "birthday_bonus_points", "anniversary_bonus_points", "tier_requirements", "tier_benefits", "is_active", "created_at", "updated_at", "created_by", "updated_by" FROM "loyalty_programs"`);
        await queryRunner.query(`DROP TABLE "loyalty_programs"`);
        await queryRunner.query(`ALTER TABLE "temporary_loyalty_programs" RENAME TO "loyalty_programs"`);
        await queryRunner.query(`CREATE INDEX "idx_loyalty_programs_active" ON "loyalty_programs" ("is_active") `);
        await queryRunner.query(`CREATE INDEX "idx_loyalty_programs_created" ON "loyalty_programs" ("created_at") `);
        await queryRunner.query(`DROP INDEX "idx_loyalty_customers_customer"`);
        await queryRunner.query(`DROP INDEX "idx_loyalty_customers_tier"`);
        await queryRunner.query(`DROP INDEX "idx_loyalty_customers_active"`);
        await queryRunner.query(`DROP INDEX "idx_loyalty_customers_points"`);
        await queryRunner.query(`CREATE TABLE "temporary_loyalty_customers" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "customer_id" integer NOT NULL, "customer_code" varchar NOT NULL, "tier" varchar NOT NULL DEFAULT ('bronze'), "current_points" integer NOT NULL DEFAULT (0), "total_points_earned" integer NOT NULL DEFAULT (0), "total_points_redeemed" integer NOT NULL DEFAULT (0), "available_points" integer NOT NULL DEFAULT (0), "pending_points" integer NOT NULL DEFAULT (0), "points_expiring_soon" integer NOT NULL DEFAULT (0), "next_tier_points_needed" integer NOT NULL DEFAULT (0), "last_tier_upgrade" datetime, "membership_start_date" datetime NOT NULL DEFAULT (CURRENT_TIMESTAMP), "membership_end_date" datetime, "last_points_activity" datetime, "is_active" boolean NOT NULL DEFAULT (1), "enrollment_source" varchar, "receive_points_notifications" boolean NOT NULL DEFAULT (1), "receive_tier_notifications" boolean NOT NULL DEFAULT (1), "created_at" datetime NOT NULL DEFAULT (CURRENT_TIMESTAMP), "updated_at" datetime NOT NULL DEFAULT (CURRENT_TIMESTAMP), "created_by" integer, "updated_by" integer, CONSTRAINT "FK_32a594135702a9afad109059175" FOREIGN KEY ("customer_id") REFERENCES "customers" ("id") ON DELETE NO ACTION ON UPDATE NO ACTION)`);
        await queryRunner.query(`INSERT INTO "temporary_loyalty_customers"("id", "customer_id", "customer_code", "tier", "current_points", "total_points_earned", "total_points_redeemed", "available_points", "pending_points", "points_expiring_soon", "next_tier_points_needed", "last_tier_upgrade", "membership_start_date", "membership_end_date", "last_points_activity", "is_active", "enrollment_source", "receive_points_notifications", "receive_tier_notifications", "created_at", "updated_at", "created_by", "updated_by") SELECT "id", "customer_id", "customer_code", "tier", "current_points", "total_points_earned", "total_points_redeemed", "available_points", "pending_points", "points_expiring_soon", "next_tier_points_needed", "last_tier_upgrade", "membership_start_date", "membership_end_date", "last_points_activity", "is_active", "enrollment_source", "receive_points_notifications", "receive_tier_notifications", "created_at", "updated_at", "created_by", "updated_by" FROM "loyalty_customers"`);
        await queryRunner.query(`DROP TABLE "loyalty_customers"`);
        await queryRunner.query(`ALTER TABLE "temporary_loyalty_customers" RENAME TO "loyalty_customers"`);
        await queryRunner.query(`CREATE UNIQUE INDEX "idx_loyalty_customers_customer" ON "loyalty_customers" ("customer_id") `);
        await queryRunner.query(`CREATE INDEX "idx_loyalty_customers_tier" ON "loyalty_customers" ("tier") `);
        await queryRunner.query(`CREATE INDEX "idx_loyalty_customers_active" ON "loyalty_customers" ("is_active") `);
        await queryRunner.query(`CREATE INDEX "idx_loyalty_customers_points" ON "loyalty_customers" ("available_points") `);
        await queryRunner.query(`DROP INDEX "idx_points_transactions_customer"`);
        await queryRunner.query(`DROP INDEX "idx_points_transactions_type"`);
        await queryRunner.query(`DROP INDEX "idx_points_transactions_reference"`);
        await queryRunner.query(`DROP INDEX "idx_points_transactions_created"`);
        await queryRunner.query(`DROP INDEX "idx_points_transactions_expiration"`);
        await queryRunner.query(`CREATE TABLE "temporary_points_transactions" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "customer_id" integer NOT NULL, "loyalty_customer_id" integer NOT NULL, "transaction_type" varchar NOT NULL DEFAULT ('earn'), "points_amount" integer NOT NULL, "balance_before" integer NOT NULL, "balance_after" integer NOT NULL, "reference_type" varchar, "reference_id" integer, "reference_number" varchar, "description" varchar, "expiration_date" datetime, "status" varchar NOT NULL DEFAULT ('active'), "created_at" datetime NOT NULL DEFAULT (CURRENT_TIMESTAMP), "created_by" integer, "reversed_at" datetime, "reversed_by" integer, "reversal_reason" varchar, CONSTRAINT "FK_9f9ddabf71cc58cf8e9315b361d" FOREIGN KEY ("loyalty_customer_id") REFERENCES "loyalty_customers" ("id") ON DELETE NO ACTION ON UPDATE NO ACTION, CONSTRAINT "FK_bd6b7ca42fe906e1c9b88ce16e6" FOREIGN KEY ("customer_id") REFERENCES "customers" ("id") ON DELETE NO ACTION ON UPDATE NO ACTION, CONSTRAINT "FK_88dab6f4ea59ea56acd86789141" FOREIGN KEY ("created_by") REFERENCES "users" ("id") ON DELETE NO ACTION ON UPDATE NO ACTION)`);
        await queryRunner.query(`INSERT INTO "temporary_points_transactions"("id", "customer_id", "loyalty_customer_id", "transaction_type", "points_amount", "balance_before", "balance_after", "reference_type", "reference_id", "reference_number", "description", "expiration_date", "status", "created_at", "created_by", "reversed_at", "reversed_by", "reversal_reason") SELECT "id", "customer_id", "loyalty_customer_id", "transaction_type", "points_amount", "balance_before", "balance_after", "reference_type", "reference_id", "reference_number", "description", "expiration_date", "status", "created_at", "created_by", "reversed_at", "reversed_by", "reversal_reason" FROM "points_transactions"`);
        await queryRunner.query(`DROP TABLE "points_transactions"`);
        await queryRunner.query(`ALTER TABLE "temporary_points_transactions" RENAME TO "points_transactions"`);
        await queryRunner.query(`CREATE INDEX "idx_points_transactions_customer" ON "points_transactions" ("customer_id") `);
        await queryRunner.query(`CREATE INDEX "idx_points_transactions_type" ON "points_transactions" ("transaction_type") `);
        await queryRunner.query(`CREATE INDEX "idx_points_transactions_reference" ON "points_transactions" ("reference_type", "reference_id") `);
        await queryRunner.query(`CREATE INDEX "idx_points_transactions_created" ON "points_transactions" ("created_at") `);
        await queryRunner.query(`CREATE INDEX "idx_points_transactions_expiration" ON "points_transactions" ("expiration_date") `);
        await queryRunner.query(`DROP INDEX "idx_reward_items_code"`);
        await queryRunner.query(`DROP INDEX "idx_reward_items_category"`);
        await queryRunner.query(`DROP INDEX "idx_reward_items_active"`);
        await queryRunner.query(`DROP INDEX "idx_reward_items_points"`);
        await queryRunner.query(`CREATE TABLE "temporary_reward_items" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "reward_code" varchar NOT NULL, "reward_name" varchar NOT NULL, "description" text, "category" varchar NOT NULL DEFAULT ('discount'), "points_cost" integer NOT NULL, "cash_value" decimal(10,2), "discount_percentage" decimal(5,2), "stock_quantity" integer NOT NULL DEFAULT (-1), "max_redemptions_per_customer" integer NOT NULL DEFAULT (1), "total_redemptions" integer NOT NULL DEFAULT (0), "validity_period_days" integer NOT NULL DEFAULT (30), "valid_from" datetime, "valid_to" datetime, "product_id" integer, "product_quantity" integer NOT NULL DEFAULT (1), "is_active" boolean NOT NULL DEFAULT (1), "image_url" varchar, "terms_conditions" text, "eligible_tiers" text DEFAULT ('bronze,silver,gold,platinum'), "min_points_balance" integer NOT NULL DEFAULT (0), "created_at" datetime NOT NULL DEFAULT (CURRENT_TIMESTAMP), "updated_at" datetime NOT NULL DEFAULT (CURRENT_TIMESTAMP), "created_by" integer, "updated_by" integer, CONSTRAINT "UQ_a24691bdbdb2954bf9d872f54dc" UNIQUE ("reward_code"), CONSTRAINT "FK_1c46c40670abad8273fc279f527" FOREIGN KEY ("product_id") REFERENCES "products" ("id") ON DELETE NO ACTION ON UPDATE NO ACTION)`);
        await queryRunner.query(`INSERT INTO "temporary_reward_items"("id", "reward_code", "reward_name", "description", "category", "points_cost", "cash_value", "discount_percentage", "stock_quantity", "max_redemptions_per_customer", "total_redemptions", "validity_period_days", "valid_from", "valid_to", "product_id", "product_quantity", "is_active", "image_url", "terms_conditions", "eligible_tiers", "min_points_balance", "created_at", "updated_at", "created_by", "updated_by") SELECT "id", "reward_code", "reward_name", "description", "category", "points_cost", "cash_value", "discount_percentage", "stock_quantity", "max_redemptions_per_customer", "total_redemptions", "validity_period_days", "valid_from", "valid_to", "product_id", "product_quantity", "is_active", "image_url", "terms_conditions", "eligible_tiers", "min_points_balance", "created_at", "updated_at", "created_by", "updated_by" FROM "reward_items"`);
        await queryRunner.query(`DROP TABLE "reward_items"`);
        await queryRunner.query(`ALTER TABLE "temporary_reward_items" RENAME TO "reward_items"`);
        await queryRunner.query(`CREATE UNIQUE INDEX "idx_reward_items_code" ON "reward_items" ("reward_code") `);
        await queryRunner.query(`CREATE INDEX "idx_reward_items_category" ON "reward_items" ("category") `);
        await queryRunner.query(`CREATE INDEX "idx_reward_items_active" ON "reward_items" ("is_active") `);
        await queryRunner.query(`CREATE INDEX "idx_reward_items_points" ON "reward_items" ("points_cost") `);
        await queryRunner.query(`DROP INDEX "idx_redemption_history_code"`);
        await queryRunner.query(`DROP INDEX "idx_redemption_history_customer"`);
        await queryRunner.query(`DROP INDEX "idx_redemption_history_reward"`);
        await queryRunner.query(`DROP INDEX "idx_redemption_history_status"`);
        await queryRunner.query(`DROP INDEX "idx_redemption_history_date"`);
        await queryRunner.query(`CREATE TABLE "temporary_redemption_history" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "redemption_code" varchar NOT NULL, "customer_id" integer NOT NULL, "loyalty_customer_id" integer NOT NULL, "reward_id" integer NOT NULL, "reward_name" varchar NOT NULL, "points_cost" integer NOT NULL, "quantity" integer NOT NULL DEFAULT (1), "status" varchar NOT NULL DEFAULT ('pending'), "redemption_date" datetime NOT NULL DEFAULT (CURRENT_TIMESTAMP), "approval_date" datetime, "fulfillment_date" datetime, "expiration_date" datetime, "fulfillment_method" varchar, "tracking_number" varchar, "carrier" varchar, "shipping_address" text, "digital_delivery_code" varchar, "digital_delivery_expiry" datetime, "notes" text, "created_at" datetime NOT NULL DEFAULT (CURRENT_TIMESTAMP), "created_by" integer, "approved_by" integer, "fulfilled_by" integer, CONSTRAINT "UQ_60ecddee649b3911ef3024e607c" UNIQUE ("redemption_code"), CONSTRAINT "FK_2317eb19186d9607402207167c9" FOREIGN KEY ("loyalty_customer_id") REFERENCES "loyalty_customers" ("id") ON DELETE NO ACTION ON UPDATE NO ACTION, CONSTRAINT "FK_26214566aa3b3253b5de4c3f249" FOREIGN KEY ("customer_id") REFERENCES "customers" ("id") ON DELETE NO ACTION ON UPDATE NO ACTION, CONSTRAINT "FK_72cfa972adaa13a5dc88d7febc9" FOREIGN KEY ("reward_id") REFERENCES "reward_items" ("id") ON DELETE NO ACTION ON UPDATE NO ACTION)`);
        await queryRunner.query(`INSERT INTO "temporary_redemption_history"("id", "redemption_code", "customer_id", "loyalty_customer_id", "reward_id", "reward_name", "points_cost", "quantity", "status", "redemption_date", "approval_date", "fulfillment_date", "expiration_date", "fulfillment_method", "tracking_number", "carrier", "shipping_address", "digital_delivery_code", "digital_delivery_expiry", "notes", "created_at", "created_by", "approved_by", "fulfilled_by") SELECT "id", "redemption_code", "customer_id", "loyalty_customer_id", "reward_id", "reward_name", "points_cost", "quantity", "status", "redemption_date", "approval_date", "fulfillment_date", "expiration_date", "fulfillment_method", "tracking_number", "carrier", "shipping_address", "digital_delivery_code", "digital_delivery_expiry", "notes", "created_at", "created_by", "approved_by", "fulfilled_by" FROM "redemption_history"`);
        await queryRunner.query(`DROP TABLE "redemption_history"`);
        await queryRunner.query(`ALTER TABLE "temporary_redemption_history" RENAME TO "redemption_history"`);
        await queryRunner.query(`CREATE UNIQUE INDEX "idx_redemption_history_code" ON "redemption_history" ("redemption_code") `);
        await queryRunner.query(`CREATE INDEX "idx_redemption_history_customer" ON "redemption_history" ("customer_id") `);
        await queryRunner.query(`CREATE INDEX "idx_redemption_history_reward" ON "redemption_history" ("reward_id") `);
        await queryRunner.query(`CREATE INDEX "idx_redemption_history_status" ON "redemption_history" ("status") `);
        await queryRunner.query(`CREATE INDEX "idx_redemption_history_date" ON "redemption_history" ("redemption_date") `);
        await queryRunner.query(`DROP INDEX "idx_customers_customer_code"`);
        await queryRunner.query(`DROP INDEX "idx_customers_email"`);
        await queryRunner.query(`DROP INDEX "idx_customers_phone"`);
        await queryRunner.query(`DROP INDEX "idx_customers_status"`);
        await queryRunner.query(`DROP INDEX "idx_customers_customer_type"`);
        await queryRunner.query(`DROP INDEX "idx_customers_company_name"`);
        await queryRunner.query(`DROP INDEX "idx_customers_last_purchase"`);
        await queryRunner.query(`CREATE TABLE "temporary_customers" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "customer_code" varchar NOT NULL, "first_name" varchar, "last_name" varchar, "display_name" varchar, "email" varchar, "phone" varchar, "mobile" varchar, "address_line1" varchar, "address_line2" varchar, "city" varchar, "state" varchar, "postal_code" varchar, "country" varchar, "company_name" varchar, "tax_id" varchar, "customer_type" varchar NOT NULL DEFAULT ('individual'), "status" varchar NOT NULL DEFAULT ('active'), "credit_limit" decimal(10,2) NOT NULL DEFAULT (0), "current_balance" decimal(10,2) NOT NULL DEFAULT (0), "payment_terms" varchar, "preferred_payment_method" varchar, "customer_group" varchar, "customer_rating" integer NOT NULL DEFAULT (0), "notes" text, "tags" text, "allow_marketing_emails" boolean NOT NULL DEFAULT (1), "allow_sms_notifications" boolean NOT NULL DEFAULT (1), "created_at" datetime NOT NULL DEFAULT (datetime('now')), "updated_at" datetime NOT NULL DEFAULT (datetime('now')), "last_purchase_at" datetime, "created_by" integer, "updated_by" integer, CONSTRAINT "UQ_acd5656a9fa7cf04125f0848165" UNIQUE ("customer_code"), CONSTRAINT "FK_8f138f284609b045dc64c91757a" FOREIGN KEY ("created_by") REFERENCES "users" ("id") ON DELETE NO ACTION ON UPDATE NO ACTION, CONSTRAINT "FK_3b68fb19c315b75686c7f87fe78" FOREIGN KEY ("updated_by") REFERENCES "users" ("id") ON DELETE NO ACTION ON UPDATE NO ACTION)`);
        await queryRunner.query(`INSERT INTO "temporary_customers"("id", "customer_code", "first_name", "last_name", "display_name", "email", "phone", "mobile", "address_line1", "address_line2", "city", "state", "postal_code", "country", "company_name", "tax_id", "customer_type", "status", "credit_limit", "current_balance", "payment_terms", "preferred_payment_method", "customer_group", "customer_rating", "notes", "tags", "allow_marketing_emails", "allow_sms_notifications", "created_at", "updated_at", "last_purchase_at", "created_by", "updated_by") SELECT "id", "customer_code", "first_name", "last_name", "display_name", "email", "phone", "mobile", "address_line1", "address_line2", "city", "state", "postal_code", "country", "company_name", "tax_id", "customer_type", "status", "credit_limit", "current_balance", "payment_terms", "preferred_payment_method", "customer_group", "customer_rating", "notes", "tags", "allow_marketing_emails", "allow_sms_notifications", "created_at", "updated_at", "last_purchase_at", "created_by", "updated_by" FROM "customers"`);
        await queryRunner.query(`DROP TABLE "customers"`);
        await queryRunner.query(`ALTER TABLE "temporary_customers" RENAME TO "customers"`);
        await queryRunner.query(`CREATE UNIQUE INDEX "idx_customers_customer_code" ON "customers" ("customer_code") `);
        await queryRunner.query(`CREATE INDEX "idx_customers_email" ON "customers" ("email") `);
        await queryRunner.query(`CREATE INDEX "idx_customers_phone" ON "customers" ("phone") `);
        await queryRunner.query(`CREATE INDEX "idx_customers_status" ON "customers" ("status") `);
        await queryRunner.query(`CREATE INDEX "idx_customers_customer_type" ON "customers" ("customer_type") `);
        await queryRunner.query(`CREATE INDEX "idx_customers_company_name" ON "customers" ("company_name") `);
        await queryRunner.query(`CREATE INDEX "idx_customers_last_purchase" ON "customers" ("last_purchase_at") `);
        await queryRunner.query(`DROP INDEX "idx_categories_name"`);
        await queryRunner.query(`DROP INDEX "idx_categories_parent"`);
        await queryRunner.query(`CREATE TABLE "temporary_categories" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar NOT NULL, "description" text, "parent_id" integer, "sort_order" integer NOT NULL DEFAULT (0), "image_url" varchar, "is_active" boolean NOT NULL DEFAULT (1), "created_at" datetime NOT NULL DEFAULT (datetime('now')), "updated_at" datetime NOT NULL DEFAULT (datetime('now')), CONSTRAINT "FK_88cea2dc9c31951d06437879b40" FOREIGN KEY ("parent_id") REFERENCES "categories" ("id") ON DELETE NO ACTION ON UPDATE NO ACTION)`);
        await queryRunner.query(`INSERT INTO "temporary_categories"("id", "name", "description", "parent_id", "sort_order", "image_url", "is_active", "created_at", "updated_at") SELECT "id", "name", "description", "parent_id", "sort_order", "image_url", "is_active", "created_at", "updated_at" FROM "categories"`);
        await queryRunner.query(`DROP TABLE "categories"`);
        await queryRunner.query(`ALTER TABLE "temporary_categories" RENAME TO "categories"`);
        await queryRunner.query(`CREATE INDEX "idx_categories_name" ON "categories" ("name") `);
        await queryRunner.query(`CREATE INDEX "idx_categories_parent" ON "categories" ("parent_id") `);
        await queryRunner.query(`DROP INDEX "idx_variants_product"`);
        await queryRunner.query(`DROP INDEX "idx_variants_sku"`);
        await queryRunner.query(`CREATE TABLE "temporary_product_variants" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "product_id" integer NOT NULL, "sku" varchar NOT NULL, "variant_name" varchar NOT NULL, "attributes" text, "price_adjustment" decimal(10,2) NOT NULL DEFAULT (0), "stock" integer NOT NULL DEFAULT (0), "barcode" varchar, "image_url" varchar, "is_active" boolean NOT NULL DEFAULT (1), "created_at" datetime NOT NULL DEFAULT (datetime('now')), "updated_at" datetime NOT NULL DEFAULT (datetime('now')), CONSTRAINT "UQ_46f236f21640f9da218a063a866" UNIQUE ("sku"), CONSTRAINT "UQ_62124a7ca2686cbaed42f0d3a29" UNIQUE ("barcode"), CONSTRAINT "FK_6343513e20e2deab45edfce1316" FOREIGN KEY ("product_id") REFERENCES "products" ("id") ON DELETE NO ACTION ON UPDATE NO ACTION)`);
        await queryRunner.query(`INSERT INTO "temporary_product_variants"("id", "product_id", "sku", "variant_name", "attributes", "price_adjustment", "stock", "barcode", "image_url", "is_active", "created_at", "updated_at") SELECT "id", "product_id", "sku", "variant_name", "attributes", "price_adjustment", "stock", "barcode", "image_url", "is_active", "created_at", "updated_at" FROM "product_variants"`);
        await queryRunner.query(`DROP TABLE "product_variants"`);
        await queryRunner.query(`ALTER TABLE "temporary_product_variants" RENAME TO "product_variants"`);
        await queryRunner.query(`CREATE INDEX "idx_variants_product" ON "product_variants" ("product_id") `);
        await queryRunner.query(`CREATE UNIQUE INDEX "idx_variants_sku" ON "product_variants" ("sku") `);
    }

    /**
     * @param {QueryRunner} queryRunner
     */
    async down(queryRunner) {
        await queryRunner.query(`DROP INDEX "idx_variants_sku"`);
        await queryRunner.query(`DROP INDEX "idx_variants_product"`);
        await queryRunner.query(`ALTER TABLE "product_variants" RENAME TO "temporary_product_variants"`);
        await queryRunner.query(`CREATE TABLE "product_variants" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "product_id" integer NOT NULL, "sku" varchar NOT NULL, "variant_name" varchar NOT NULL, "attributes" text, "price_adjustment" decimal(10,2) NOT NULL DEFAULT (0), "stock" integer NOT NULL DEFAULT (0), "barcode" varchar, "image_url" varchar, "is_active" boolean NOT NULL DEFAULT (1), "created_at" datetime NOT NULL DEFAULT (datetime('now')), "updated_at" datetime NOT NULL DEFAULT (datetime('now')), CONSTRAINT "UQ_46f236f21640f9da218a063a866" UNIQUE ("sku"), CONSTRAINT "UQ_62124a7ca2686cbaed42f0d3a29" UNIQUE ("barcode"))`);
        await queryRunner.query(`INSERT INTO "product_variants"("id", "product_id", "sku", "variant_name", "attributes", "price_adjustment", "stock", "barcode", "image_url", "is_active", "created_at", "updated_at") SELECT "id", "product_id", "sku", "variant_name", "attributes", "price_adjustment", "stock", "barcode", "image_url", "is_active", "created_at", "updated_at" FROM "temporary_product_variants"`);
        await queryRunner.query(`DROP TABLE "temporary_product_variants"`);
        await queryRunner.query(`CREATE UNIQUE INDEX "idx_variants_sku" ON "product_variants" ("sku") `);
        await queryRunner.query(`CREATE INDEX "idx_variants_product" ON "product_variants" ("product_id") `);
        await queryRunner.query(`DROP INDEX "idx_categories_parent"`);
        await queryRunner.query(`DROP INDEX "idx_categories_name"`);
        await queryRunner.query(`ALTER TABLE "categories" RENAME TO "temporary_categories"`);
        await queryRunner.query(`CREATE TABLE "categories" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar NOT NULL, "description" text, "parent_id" integer, "sort_order" integer NOT NULL DEFAULT (0), "image_url" varchar, "is_active" boolean NOT NULL DEFAULT (1), "created_at" datetime NOT NULL DEFAULT (datetime('now')), "updated_at" datetime NOT NULL DEFAULT (datetime('now')))`);
        await queryRunner.query(`INSERT INTO "categories"("id", "name", "description", "parent_id", "sort_order", "image_url", "is_active", "created_at", "updated_at") SELECT "id", "name", "description", "parent_id", "sort_order", "image_url", "is_active", "created_at", "updated_at" FROM "temporary_categories"`);
        await queryRunner.query(`DROP TABLE "temporary_categories"`);
        await queryRunner.query(`CREATE INDEX "idx_categories_parent" ON "categories" ("parent_id") `);
        await queryRunner.query(`CREATE INDEX "idx_categories_name" ON "categories" ("name") `);
        await queryRunner.query(`DROP INDEX "idx_customers_last_purchase"`);
        await queryRunner.query(`DROP INDEX "idx_customers_company_name"`);
        await queryRunner.query(`DROP INDEX "idx_customers_customer_type"`);
        await queryRunner.query(`DROP INDEX "idx_customers_status"`);
        await queryRunner.query(`DROP INDEX "idx_customers_phone"`);
        await queryRunner.query(`DROP INDEX "idx_customers_email"`);
        await queryRunner.query(`DROP INDEX "idx_customers_customer_code"`);
        await queryRunner.query(`ALTER TABLE "customers" RENAME TO "temporary_customers"`);
        await queryRunner.query(`CREATE TABLE "customers" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "customer_code" varchar NOT NULL, "first_name" varchar, "last_name" varchar, "display_name" varchar, "email" varchar, "phone" varchar, "mobile" varchar, "address_line1" varchar, "address_line2" varchar, "city" varchar, "state" varchar, "postal_code" varchar, "country" varchar, "company_name" varchar, "tax_id" varchar, "customer_type" varchar NOT NULL DEFAULT ('individual'), "status" varchar NOT NULL DEFAULT ('active'), "credit_limit" decimal(10,2) NOT NULL DEFAULT (0), "current_balance" decimal(10,2) NOT NULL DEFAULT (0), "payment_terms" varchar, "preferred_payment_method" varchar, "customer_group" varchar, "customer_rating" integer NOT NULL DEFAULT (0), "notes" text, "tags" text, "allow_marketing_emails" boolean NOT NULL DEFAULT (1), "allow_sms_notifications" boolean NOT NULL DEFAULT (1), "created_at" datetime NOT NULL DEFAULT (datetime('now')), "updated_at" datetime NOT NULL DEFAULT (datetime('now')), "last_purchase_at" datetime, "created_by" integer, "updated_by" integer, CONSTRAINT "UQ_acd5656a9fa7cf04125f0848165" UNIQUE ("customer_code"))`);
        await queryRunner.query(`INSERT INTO "customers"("id", "customer_code", "first_name", "last_name", "display_name", "email", "phone", "mobile", "address_line1", "address_line2", "city", "state", "postal_code", "country", "company_name", "tax_id", "customer_type", "status", "credit_limit", "current_balance", "payment_terms", "preferred_payment_method", "customer_group", "customer_rating", "notes", "tags", "allow_marketing_emails", "allow_sms_notifications", "created_at", "updated_at", "last_purchase_at", "created_by", "updated_by") SELECT "id", "customer_code", "first_name", "last_name", "display_name", "email", "phone", "mobile", "address_line1", "address_line2", "city", "state", "postal_code", "country", "company_name", "tax_id", "customer_type", "status", "credit_limit", "current_balance", "payment_terms", "preferred_payment_method", "customer_group", "customer_rating", "notes", "tags", "allow_marketing_emails", "allow_sms_notifications", "created_at", "updated_at", "last_purchase_at", "created_by", "updated_by" FROM "temporary_customers"`);
        await queryRunner.query(`DROP TABLE "temporary_customers"`);
        await queryRunner.query(`CREATE INDEX "idx_customers_last_purchase" ON "customers" ("last_purchase_at") `);
        await queryRunner.query(`CREATE INDEX "idx_customers_company_name" ON "customers" ("company_name") `);
        await queryRunner.query(`CREATE INDEX "idx_customers_customer_type" ON "customers" ("customer_type") `);
        await queryRunner.query(`CREATE INDEX "idx_customers_status" ON "customers" ("status") `);
        await queryRunner.query(`CREATE INDEX "idx_customers_phone" ON "customers" ("phone") `);
        await queryRunner.query(`CREATE INDEX "idx_customers_email" ON "customers" ("email") `);
        await queryRunner.query(`CREATE UNIQUE INDEX "idx_customers_customer_code" ON "customers" ("customer_code") `);
        await queryRunner.query(`DROP INDEX "idx_redemption_history_date"`);
        await queryRunner.query(`DROP INDEX "idx_redemption_history_status"`);
        await queryRunner.query(`DROP INDEX "idx_redemption_history_reward"`);
        await queryRunner.query(`DROP INDEX "idx_redemption_history_customer"`);
        await queryRunner.query(`DROP INDEX "idx_redemption_history_code"`);
        await queryRunner.query(`ALTER TABLE "redemption_history" RENAME TO "temporary_redemption_history"`);
        await queryRunner.query(`CREATE TABLE "redemption_history" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "redemption_code" varchar NOT NULL, "customer_id" integer NOT NULL, "loyalty_customer_id" integer NOT NULL, "reward_id" integer NOT NULL, "reward_name" varchar NOT NULL, "points_cost" integer NOT NULL, "quantity" integer NOT NULL DEFAULT (1), "status" varchar NOT NULL DEFAULT ('pending'), "redemption_date" datetime NOT NULL DEFAULT (CURRENT_TIMESTAMP), "approval_date" datetime, "fulfillment_date" datetime, "expiration_date" datetime, "fulfillment_method" varchar, "tracking_number" varchar, "carrier" varchar, "shipping_address" text, "digital_delivery_code" varchar, "digital_delivery_expiry" datetime, "notes" text, "created_at" datetime NOT NULL DEFAULT (CURRENT_TIMESTAMP), "created_by" integer, "approved_by" integer, "fulfilled_by" integer, CONSTRAINT "UQ_60ecddee649b3911ef3024e607c" UNIQUE ("redemption_code"))`);
        await queryRunner.query(`INSERT INTO "redemption_history"("id", "redemption_code", "customer_id", "loyalty_customer_id", "reward_id", "reward_name", "points_cost", "quantity", "status", "redemption_date", "approval_date", "fulfillment_date", "expiration_date", "fulfillment_method", "tracking_number", "carrier", "shipping_address", "digital_delivery_code", "digital_delivery_expiry", "notes", "created_at", "created_by", "approved_by", "fulfilled_by") SELECT "id", "redemption_code", "customer_id", "loyalty_customer_id", "reward_id", "reward_name", "points_cost", "quantity", "status", "redemption_date", "approval_date", "fulfillment_date", "expiration_date", "fulfillment_method", "tracking_number", "carrier", "shipping_address", "digital_delivery_code", "digital_delivery_expiry", "notes", "created_at", "created_by", "approved_by", "fulfilled_by" FROM "temporary_redemption_history"`);
        await queryRunner.query(`DROP TABLE "temporary_redemption_history"`);
        await queryRunner.query(`CREATE INDEX "idx_redemption_history_date" ON "redemption_history" ("redemption_date") `);
        await queryRunner.query(`CREATE INDEX "idx_redemption_history_status" ON "redemption_history" ("status") `);
        await queryRunner.query(`CREATE INDEX "idx_redemption_history_reward" ON "redemption_history" ("reward_id") `);
        await queryRunner.query(`CREATE INDEX "idx_redemption_history_customer" ON "redemption_history" ("customer_id") `);
        await queryRunner.query(`CREATE UNIQUE INDEX "idx_redemption_history_code" ON "redemption_history" ("redemption_code") `);
        await queryRunner.query(`DROP INDEX "idx_reward_items_points"`);
        await queryRunner.query(`DROP INDEX "idx_reward_items_active"`);
        await queryRunner.query(`DROP INDEX "idx_reward_items_category"`);
        await queryRunner.query(`DROP INDEX "idx_reward_items_code"`);
        await queryRunner.query(`ALTER TABLE "reward_items" RENAME TO "temporary_reward_items"`);
        await queryRunner.query(`CREATE TABLE "reward_items" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "reward_code" varchar NOT NULL, "reward_name" varchar NOT NULL, "description" text, "category" varchar NOT NULL DEFAULT ('discount'), "points_cost" integer NOT NULL, "cash_value" decimal(10,2), "discount_percentage" decimal(5,2), "stock_quantity" integer NOT NULL DEFAULT (-1), "max_redemptions_per_customer" integer NOT NULL DEFAULT (1), "total_redemptions" integer NOT NULL DEFAULT (0), "validity_period_days" integer NOT NULL DEFAULT (30), "valid_from" datetime, "valid_to" datetime, "product_id" integer, "product_quantity" integer NOT NULL DEFAULT (1), "is_active" boolean NOT NULL DEFAULT (1), "image_url" varchar, "terms_conditions" text, "eligible_tiers" text DEFAULT ('bronze,silver,gold,platinum'), "min_points_balance" integer NOT NULL DEFAULT (0), "created_at" datetime NOT NULL DEFAULT (CURRENT_TIMESTAMP), "updated_at" datetime NOT NULL DEFAULT (CURRENT_TIMESTAMP), "created_by" integer, "updated_by" integer, CONSTRAINT "UQ_a24691bdbdb2954bf9d872f54dc" UNIQUE ("reward_code"))`);
        await queryRunner.query(`INSERT INTO "reward_items"("id", "reward_code", "reward_name", "description", "category", "points_cost", "cash_value", "discount_percentage", "stock_quantity", "max_redemptions_per_customer", "total_redemptions", "validity_period_days", "valid_from", "valid_to", "product_id", "product_quantity", "is_active", "image_url", "terms_conditions", "eligible_tiers", "min_points_balance", "created_at", "updated_at", "created_by", "updated_by") SELECT "id", "reward_code", "reward_name", "description", "category", "points_cost", "cash_value", "discount_percentage", "stock_quantity", "max_redemptions_per_customer", "total_redemptions", "validity_period_days", "valid_from", "valid_to", "product_id", "product_quantity", "is_active", "image_url", "terms_conditions", "eligible_tiers", "min_points_balance", "created_at", "updated_at", "created_by", "updated_by" FROM "temporary_reward_items"`);
        await queryRunner.query(`DROP TABLE "temporary_reward_items"`);
        await queryRunner.query(`CREATE INDEX "idx_reward_items_points" ON "reward_items" ("points_cost") `);
        await queryRunner.query(`CREATE INDEX "idx_reward_items_active" ON "reward_items" ("is_active") `);
        await queryRunner.query(`CREATE INDEX "idx_reward_items_category" ON "reward_items" ("category") `);
        await queryRunner.query(`CREATE UNIQUE INDEX "idx_reward_items_code" ON "reward_items" ("reward_code") `);
        await queryRunner.query(`DROP INDEX "idx_points_transactions_expiration"`);
        await queryRunner.query(`DROP INDEX "idx_points_transactions_created"`);
        await queryRunner.query(`DROP INDEX "idx_points_transactions_reference"`);
        await queryRunner.query(`DROP INDEX "idx_points_transactions_type"`);
        await queryRunner.query(`DROP INDEX "idx_points_transactions_customer"`);
        await queryRunner.query(`ALTER TABLE "points_transactions" RENAME TO "temporary_points_transactions"`);
        await queryRunner.query(`CREATE TABLE "points_transactions" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "customer_id" integer NOT NULL, "loyalty_customer_id" integer NOT NULL, "transaction_type" varchar NOT NULL DEFAULT ('earn'), "points_amount" integer NOT NULL, "balance_before" integer NOT NULL, "balance_after" integer NOT NULL, "reference_type" varchar, "reference_id" integer, "reference_number" varchar, "description" varchar, "expiration_date" datetime, "status" varchar NOT NULL DEFAULT ('active'), "created_at" datetime NOT NULL DEFAULT (CURRENT_TIMESTAMP), "created_by" integer, "reversed_at" datetime, "reversed_by" integer, "reversal_reason" varchar)`);
        await queryRunner.query(`INSERT INTO "points_transactions"("id", "customer_id", "loyalty_customer_id", "transaction_type", "points_amount", "balance_before", "balance_after", "reference_type", "reference_id", "reference_number", "description", "expiration_date", "status", "created_at", "created_by", "reversed_at", "reversed_by", "reversal_reason") SELECT "id", "customer_id", "loyalty_customer_id", "transaction_type", "points_amount", "balance_before", "balance_after", "reference_type", "reference_id", "reference_number", "description", "expiration_date", "status", "created_at", "created_by", "reversed_at", "reversed_by", "reversal_reason" FROM "temporary_points_transactions"`);
        await queryRunner.query(`DROP TABLE "temporary_points_transactions"`);
        await queryRunner.query(`CREATE INDEX "idx_points_transactions_expiration" ON "points_transactions" ("expiration_date") `);
        await queryRunner.query(`CREATE INDEX "idx_points_transactions_created" ON "points_transactions" ("created_at") `);
        await queryRunner.query(`CREATE INDEX "idx_points_transactions_reference" ON "points_transactions" ("reference_type", "reference_id") `);
        await queryRunner.query(`CREATE INDEX "idx_points_transactions_type" ON "points_transactions" ("transaction_type") `);
        await queryRunner.query(`CREATE INDEX "idx_points_transactions_customer" ON "points_transactions" ("customer_id") `);
        await queryRunner.query(`DROP INDEX "idx_loyalty_customers_points"`);
        await queryRunner.query(`DROP INDEX "idx_loyalty_customers_active"`);
        await queryRunner.query(`DROP INDEX "idx_loyalty_customers_tier"`);
        await queryRunner.query(`DROP INDEX "idx_loyalty_customers_customer"`);
        await queryRunner.query(`ALTER TABLE "loyalty_customers" RENAME TO "temporary_loyalty_customers"`);
        await queryRunner.query(`CREATE TABLE "loyalty_customers" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "customer_id" integer NOT NULL, "customer_code" varchar NOT NULL, "tier" varchar NOT NULL DEFAULT ('bronze'), "current_points" integer NOT NULL DEFAULT (0), "total_points_earned" integer NOT NULL DEFAULT (0), "total_points_redeemed" integer NOT NULL DEFAULT (0), "available_points" integer NOT NULL DEFAULT (0), "pending_points" integer NOT NULL DEFAULT (0), "points_expiring_soon" integer NOT NULL DEFAULT (0), "next_tier_points_needed" integer NOT NULL DEFAULT (0), "last_tier_upgrade" datetime, "membership_start_date" datetime NOT NULL DEFAULT (CURRENT_TIMESTAMP), "membership_end_date" datetime, "last_points_activity" datetime, "is_active" boolean NOT NULL DEFAULT (1), "enrollment_source" varchar, "receive_points_notifications" boolean NOT NULL DEFAULT (1), "receive_tier_notifications" boolean NOT NULL DEFAULT (1), "created_at" datetime NOT NULL DEFAULT (CURRENT_TIMESTAMP), "updated_at" datetime NOT NULL DEFAULT (CURRENT_TIMESTAMP), "created_by" integer, "updated_by" integer)`);
        await queryRunner.query(`INSERT INTO "loyalty_customers"("id", "customer_id", "customer_code", "tier", "current_points", "total_points_earned", "total_points_redeemed", "available_points", "pending_points", "points_expiring_soon", "next_tier_points_needed", "last_tier_upgrade", "membership_start_date", "membership_end_date", "last_points_activity", "is_active", "enrollment_source", "receive_points_notifications", "receive_tier_notifications", "created_at", "updated_at", "created_by", "updated_by") SELECT "id", "customer_id", "customer_code", "tier", "current_points", "total_points_earned", "total_points_redeemed", "available_points", "pending_points", "points_expiring_soon", "next_tier_points_needed", "last_tier_upgrade", "membership_start_date", "membership_end_date", "last_points_activity", "is_active", "enrollment_source", "receive_points_notifications", "receive_tier_notifications", "created_at", "updated_at", "created_by", "updated_by" FROM "temporary_loyalty_customers"`);
        await queryRunner.query(`DROP TABLE "temporary_loyalty_customers"`);
        await queryRunner.query(`CREATE INDEX "idx_loyalty_customers_points" ON "loyalty_customers" ("available_points") `);
        await queryRunner.query(`CREATE INDEX "idx_loyalty_customers_active" ON "loyalty_customers" ("is_active") `);
        await queryRunner.query(`CREATE INDEX "idx_loyalty_customers_tier" ON "loyalty_customers" ("tier") `);
        await queryRunner.query(`CREATE UNIQUE INDEX "idx_loyalty_customers_customer" ON "loyalty_customers" ("customer_id") `);
        await queryRunner.query(`DROP INDEX "idx_loyalty_programs_created"`);
        await queryRunner.query(`DROP INDEX "idx_loyalty_programs_active"`);
        await queryRunner.query(`ALTER TABLE "loyalty_programs" RENAME TO "temporary_loyalty_programs"`);
        await queryRunner.query(`CREATE TABLE "loyalty_programs" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "program_name" varchar NOT NULL, "program_description" text, "points_currency_name" varchar NOT NULL DEFAULT ('Points'), "points_per_currency" decimal(10,2) NOT NULL DEFAULT (1), "minimum_redemption_points" integer NOT NULL DEFAULT (100), "expiration_months" integer NOT NULL DEFAULT (12), "signup_bonus_points" integer NOT NULL DEFAULT (0), "birthday_bonus_points" integer NOT NULL DEFAULT (0), "anniversary_bonus_points" integer NOT NULL DEFAULT (0), "tier_requirements" text DEFAULT ('{"bronze":0,"silver":1000,"gold":5000,"platinum":20000}'), "tier_benefits" text DEFAULT ('{"bronze":["5% discount on all purchases"],"silver":["10% discount","Free shipping on orders over $100"],"gold":["15% discount","Free shipping","Priority support"],"platinum":["20% discount","Free shipping","VIP support","Early access to sales"]}'), "is_active" boolean NOT NULL DEFAULT (1), "created_at" datetime NOT NULL DEFAULT (CURRENT_TIMESTAMP), "updated_at" datetime NOT NULL DEFAULT (CURRENT_TIMESTAMP), "created_by" integer, "updated_by" integer)`);
        await queryRunner.query(`INSERT INTO "loyalty_programs"("id", "program_name", "program_description", "points_currency_name", "points_per_currency", "minimum_redemption_points", "expiration_months", "signup_bonus_points", "birthday_bonus_points", "anniversary_bonus_points", "tier_requirements", "tier_benefits", "is_active", "created_at", "updated_at", "created_by", "updated_by") SELECT "id", "program_name", "program_description", "points_currency_name", "points_per_currency", "minimum_redemption_points", "expiration_months", "signup_bonus_points", "birthday_bonus_points", "anniversary_bonus_points", "tier_requirements", "tier_benefits", "is_active", "created_at", "updated_at", "created_by", "updated_by" FROM "temporary_loyalty_programs"`);
        await queryRunner.query(`DROP TABLE "temporary_loyalty_programs"`);
        await queryRunner.query(`CREATE INDEX "idx_loyalty_programs_created" ON "loyalty_programs" ("created_at") `);
        await queryRunner.query(`CREATE INDEX "idx_loyalty_programs_active" ON "loyalty_programs" ("is_active") `);
        await queryRunner.query(`DROP INDEX "idx_customer_transactions_status"`);
        await queryRunner.query(`DROP INDEX "idx_customer_transactions_date"`);
        await queryRunner.query(`DROP INDEX "idx_customer_transactions_type"`);
        await queryRunner.query(`DROP INDEX "idx_customer_transactions_customer_id"`);
        await queryRunner.query(`ALTER TABLE "customer_transactions" RENAME TO "temporary_customer_transactions"`);
        await queryRunner.query(`CREATE TABLE "customer_transactions" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "customer_id" integer NOT NULL, "transaction_type" varchar NOT NULL DEFAULT ('sale'), "transaction_date" datetime NOT NULL, "reference_id" varchar, "reference_type" varchar, "amount" decimal(10,2) NOT NULL, "balance_before" decimal(10,2) NOT NULL DEFAULT (0), "balance_after" decimal(10,2) NOT NULL DEFAULT (0), "description" text, "status" varchar NOT NULL DEFAULT ('completed'), "created_at" datetime NOT NULL DEFAULT (CURRENT_TIMESTAMP), "created_by" integer)`);
        await queryRunner.query(`INSERT INTO "customer_transactions"("id", "customer_id", "transaction_type", "transaction_date", "reference_id", "reference_type", "amount", "balance_before", "balance_after", "description", "status", "created_at", "created_by") SELECT "id", "customer_id", "transaction_type", "transaction_date", "reference_id", "reference_type", "amount", "balance_before", "balance_after", "description", "status", "created_at", "created_by" FROM "temporary_customer_transactions"`);
        await queryRunner.query(`DROP TABLE "temporary_customer_transactions"`);
        await queryRunner.query(`CREATE INDEX "idx_customer_transactions_status" ON "customer_transactions" ("status") `);
        await queryRunner.query(`CREATE INDEX "idx_customer_transactions_date" ON "customer_transactions" ("transaction_date") `);
        await queryRunner.query(`CREATE INDEX "idx_customer_transactions_type" ON "customer_transactions" ("transaction_type") `);
        await queryRunner.query(`CREATE INDEX "idx_customer_transactions_customer_id" ON "customer_transactions" ("customer_id") `);
        await queryRunner.query(`DROP INDEX "idx_customer_contacts_is_default"`);
        await queryRunner.query(`DROP INDEX "idx_customer_contacts_email"`);
        await queryRunner.query(`DROP INDEX "idx_customer_contacts_customer_id"`);
        await queryRunner.query(`ALTER TABLE "customer_contacts" RENAME TO "temporary_customer_contacts"`);
        await queryRunner.query(`CREATE TABLE "customer_contacts" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "customer_id" integer NOT NULL, "contact_type" varchar NOT NULL DEFAULT ('primary'), "first_name" varchar, "last_name" varchar, "position" varchar, "email" varchar, "phone" varchar, "mobile" varchar, "is_default_contact" boolean NOT NULL DEFAULT (0), "receive_statements" boolean NOT NULL DEFAULT (1), "receive_marketing" boolean NOT NULL DEFAULT (1), "notes" text, "created_at" datetime NOT NULL DEFAULT (datetime('now')), "updated_at" datetime NOT NULL DEFAULT (datetime('now')))`);
        await queryRunner.query(`INSERT INTO "customer_contacts"("id", "customer_id", "contact_type", "first_name", "last_name", "position", "email", "phone", "mobile", "is_default_contact", "receive_statements", "receive_marketing", "notes", "created_at", "updated_at") SELECT "id", "customer_id", "contact_type", "first_name", "last_name", "position", "email", "phone", "mobile", "is_default_contact", "receive_statements", "receive_marketing", "notes", "created_at", "updated_at" FROM "temporary_customer_contacts"`);
        await queryRunner.query(`DROP TABLE "temporary_customer_contacts"`);
        await queryRunner.query(`CREATE INDEX "idx_customer_contacts_is_default" ON "customer_contacts" ("is_default_contact") `);
        await queryRunner.query(`CREATE INDEX "idx_customer_contacts_email" ON "customer_contacts" ("email") `);
        await queryRunner.query(`CREATE INDEX "idx_customer_contacts_customer_id" ON "customer_contacts" ("customer_id") `);
        await queryRunner.query(`DROP INDEX "idx_user_activity_entity"`);
        await queryRunner.query(`DROP INDEX "idx_user_activity_action"`);
        await queryRunner.query(`DROP INDEX "idx_user_activity_user"`);
        await queryRunner.query(`ALTER TABLE "user_activities" RENAME TO "temporary_user_activities"`);
        await queryRunner.query(`CREATE TABLE "user_activities" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "user_id" integer NOT NULL, "action" varchar(100) NOT NULL, "entity" varchar(100), "entity_id" integer, "ip_address" varchar(45), "user_agent" varchar(255), "details" text, "created_at" datetime NOT NULL DEFAULT (CURRENT_TIMESTAMP))`);
        await queryRunner.query(`INSERT INTO "user_activities"("id", "user_id", "action", "entity", "entity_id", "ip_address", "user_agent", "details", "created_at") SELECT "id", "user_id", "action", "entity", "entity_id", "ip_address", "user_agent", "details", "created_at" FROM "temporary_user_activities"`);
        await queryRunner.query(`DROP TABLE "temporary_user_activities"`);
        await queryRunner.query(`CREATE INDEX "idx_user_activity_entity" ON "user_activities" ("entity", "entity_id") `);
        await queryRunner.query(`CREATE INDEX "idx_user_activity_action" ON "user_activities" ("action") `);
        await queryRunner.query(`CREATE INDEX "idx_user_activity_user" ON "user_activities" ("user_id") `);
        await queryRunner.query(`DROP INDEX "IDX_1652c84026ff083cb79617c229"`);
        await queryRunner.query(`DROP INDEX "IDX_2cc5a2c8f1e2da066d1903d058"`);
        await queryRunner.query(`DROP INDEX "IDX_81bb91edf39554fae2d4067b4c"`);
        await queryRunner.query(`DROP INDEX "IDX_ebdb4d54c8de7847c0f7a9e4fb"`);
        await queryRunner.query(`ALTER TABLE "price_history" RENAME TO "temporary_price_history"`);
        await queryRunner.query(`CREATE TABLE "price_history" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "product_id" integer NOT NULL, "old_price" integer NOT NULL, "new_price" integer NOT NULL, "change_type" varchar DEFAULT ('manual'), "change_reason" text, "effective_date" datetime NOT NULL DEFAULT (CURRENT_TIMESTAMP), "changed_by_id" integer, "reference_id" varchar, "reference_type" varchar, "created_at" datetime NOT NULL DEFAULT (datetime('now')))`);
        await queryRunner.query(`INSERT INTO "price_history"("id", "product_id", "old_price", "new_price", "change_type", "change_reason", "effective_date", "changed_by_id", "reference_id", "reference_type", "created_at") SELECT "id", "product_id", "old_price", "new_price", "change_type", "change_reason", "effective_date", "changed_by_id", "reference_id", "reference_type", "created_at" FROM "temporary_price_history"`);
        await queryRunner.query(`DROP TABLE "temporary_price_history"`);
        await queryRunner.query(`CREATE INDEX "IDX_1652c84026ff083cb79617c229" ON "price_history" ("product_id", "effective_date") `);
        await queryRunner.query(`CREATE INDEX "IDX_2cc5a2c8f1e2da066d1903d058" ON "price_history" ("change_type") `);
        await queryRunner.query(`CREATE INDEX "IDX_81bb91edf39554fae2d4067b4c" ON "price_history" ("effective_date") `);
        await queryRunner.query(`CREATE INDEX "IDX_ebdb4d54c8de7847c0f7a9e4fb" ON "price_history" ("product_id") `);
        await queryRunner.query(`DROP INDEX "idx_inventory_transaction_logs_date_action"`);
        await queryRunner.query(`DROP INDEX "idx_inventory_transaction_logs_user"`);
        await queryRunner.query(`DROP INDEX "idx_inventory_transaction_logs_reference"`);
        await queryRunner.query(`DROP INDEX "idx_inventory_transaction_logs_product"`);
        await queryRunner.query(`DROP INDEX "idx_inventory_transaction_logs_action"`);
        await queryRunner.query(`DROP INDEX "idx_inventory_transaction_logs_created_at"`);
        await queryRunner.query(`ALTER TABLE "inventory_transaction_logs" RENAME TO "temporary_inventory_transaction_logs"`);
        await queryRunner.query(`CREATE TABLE "inventory_transaction_logs" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "product_id" integer, "warehouse_id" varchar, "action" varchar(50) NOT NULL DEFAULT ('manual_adjustment'), "change_amount" integer NOT NULL, "quantity_before" integer NOT NULL, "quantity_after" integer NOT NULL, "price_before" integer, "price_after" integer, "reference_id" varchar, "reference_type" varchar(50), "performed_by_id" integer, "notes" text, "batch_number" varchar, "expiry_date" datetime, "created_at" datetime NOT NULL DEFAULT (CURRENT_TIMESTAMP), "ip_address" varchar, "user_agent" varchar)`);
        await queryRunner.query(`INSERT INTO "inventory_transaction_logs"("id", "product_id", "warehouse_id", "action", "change_amount", "quantity_before", "quantity_after", "price_before", "price_after", "reference_id", "reference_type", "performed_by_id", "notes", "batch_number", "expiry_date", "created_at", "ip_address", "user_agent") SELECT "id", "product_id", "warehouse_id", "action", "change_amount", "quantity_before", "quantity_after", "price_before", "price_after", "reference_id", "reference_type", "performed_by_id", "notes", "batch_number", "expiry_date", "created_at", "ip_address", "user_agent" FROM "temporary_inventory_transaction_logs"`);
        await queryRunner.query(`DROP TABLE "temporary_inventory_transaction_logs"`);
        await queryRunner.query(`CREATE INDEX "idx_inventory_transaction_logs_date_action" ON "inventory_transaction_logs" ("created_at", "action") `);
        await queryRunner.query(`CREATE INDEX "idx_inventory_transaction_logs_user" ON "inventory_transaction_logs" ("performed_by_id") `);
        await queryRunner.query(`CREATE INDEX "idx_inventory_transaction_logs_reference" ON "inventory_transaction_logs" ("reference_id", "reference_type") `);
        await queryRunner.query(`CREATE INDEX "idx_inventory_transaction_logs_product" ON "inventory_transaction_logs" ("product_id") `);
        await queryRunner.query(`CREATE INDEX "idx_inventory_transaction_logs_action" ON "inventory_transaction_logs" ("action") `);
        await queryRunner.query(`CREATE INDEX "idx_inventory_transaction_logs_created_at" ON "inventory_transaction_logs" ("created_at") `);
        await queryRunner.query(`DROP INDEX "idx_audit_action_time"`);
        await queryRunner.query(`DROP INDEX "idx_audit_user"`);
        await queryRunner.query(`DROP INDEX "idx_audit_entity"`);
        await queryRunner.query(`ALTER TABLE "audit_trails" RENAME TO "temporary_audit_trails"`);
        await queryRunner.query(`CREATE TABLE "audit_trails" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "action" varchar(100) NOT NULL, "entity" varchar(100) NOT NULL, "entity_id" integer NOT NULL, "details" text, "timestamp" datetime NOT NULL DEFAULT (CURRENT_TIMESTAMP), "user_id" integer NOT NULL)`);
        await queryRunner.query(`INSERT INTO "audit_trails"("id", "action", "entity", "entity_id", "details", "timestamp", "user_id") SELECT "id", "action", "entity", "entity_id", "details", "timestamp", "user_id" FROM "temporary_audit_trails"`);
        await queryRunner.query(`DROP TABLE "temporary_audit_trails"`);
        await queryRunner.query(`CREATE INDEX "idx_audit_action_time" ON "audit_trails" ("action", "timestamp") `);
        await queryRunner.query(`CREATE INDEX "idx_audit_user" ON "audit_trails" ("user_id") `);
        await queryRunner.query(`CREATE INDEX "idx_audit_entity" ON "audit_trails" ("entity", "entity_id") `);
        await queryRunner.query(`DROP INDEX "idx_products_is_deleted"`);
        await queryRunner.query(`DROP INDEX "idx_products_total_sold"`);
        await queryRunner.query(`DROP INDEX "idx_products_supplier_sku"`);
        await queryRunner.query(`DROP INDEX "idx_products_sku_name"`);
        await queryRunner.query(`DROP INDEX "idx_products_created"`);
        await queryRunner.query(`DROP INDEX "idx_products_type"`);
        await queryRunner.query(`DROP INDEX "idx_products_pos_quick_code"`);
        await queryRunner.query(`DROP INDEX "idx_products_price"`);
        await queryRunner.query(`DROP INDEX "idx_products_active"`);
        await queryRunner.query(`DROP INDEX "idx_products_stock"`);
        await queryRunner.query(`DROP INDEX "idx_products_supplier"`);
        await queryRunner.query(`DROP INDEX "idx_products_category"`);
        await queryRunner.query(`DROP INDEX "idx_products_status"`);
        await queryRunner.query(`DROP INDEX "idx_products_name"`);
        await queryRunner.query(`DROP INDEX "idx_products_barcode"`);
        await queryRunner.query(`DROP INDEX "idx_products_sku"`);
        await queryRunner.query(`ALTER TABLE "products" RENAME TO "temporary_products"`);
        await queryRunner.query(`CREATE TABLE "products" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "sku" varchar(100) NOT NULL, "barcode" varchar(100), "upc" varchar(50), "name" varchar(255) NOT NULL, "display_name" varchar(255), "description" text, "product_type" varchar NOT NULL DEFAULT ('simple'), "category_id" integer, "subcategory_id" integer, "brand_id" integer, "cost_price" decimal(12,2), "selling_price" decimal(12,2) NOT NULL, "wholesale_price" decimal(12,2), "min_price" decimal(12,2), "max_price" decimal(12,2), "markup_percentage" decimal(5,2), "stock" integer NOT NULL DEFAULT (0), "reserved_stock" integer NOT NULL DEFAULT (0), "available_stock" integer NOT NULL DEFAULT (0), "min_stock_level" integer NOT NULL DEFAULT (5), "max_stock_level" integer, "reorder_level" integer NOT NULL DEFAULT (10), "tax_rate" decimal(5,2) NOT NULL DEFAULT (0), "tax_type" varchar NOT NULL DEFAULT ('exclusive'), "is_taxable" boolean NOT NULL DEFAULT (1), "discount_percentage" decimal(5,2) NOT NULL DEFAULT (0), "discount_amount" decimal(10,2) NOT NULL DEFAULT (0), "weight" decimal(10,2), "weight_unit" varchar NOT NULL DEFAULT ('kg'), "length" decimal(10,2), "width" decimal(10,2), "height" decimal(10,2), "dimension_unit" varchar NOT NULL DEFAULT ('cm'), "supplier_id" integer, "supplier_sku" varchar, "supplier_price" decimal(12,2), "lead_time_days" integer NOT NULL DEFAULT (7), "has_expiry" boolean NOT NULL DEFAULT (0), "shelf_life_days" integer, "track_batch" boolean NOT NULL DEFAULT (0), "track_serial" boolean NOT NULL DEFAULT (0), "image_url" varchar, "image_urls" text, "thumbnail_url" varchar, "pos_quick_code" varchar, "pos_category_id" integer, "is_quick_sale" boolean NOT NULL DEFAULT (0), "is_hidden" boolean NOT NULL DEFAULT (0), "kitchen_printer_id" integer, "preparation_time" integer NOT NULL DEFAULT (0), "loyalty_points_earn" integer NOT NULL DEFAULT (0), "is_reward_product" boolean NOT NULL DEFAULT (0), "reward_points_cost" integer NOT NULL DEFAULT (0), "status" varchar NOT NULL DEFAULT ('active'), "is_active" boolean NOT NULL DEFAULT (1), "is_deleted" boolean NOT NULL DEFAULT (0), "is_bestseller" boolean NOT NULL DEFAULT (0), "is_featured" boolean NOT NULL DEFAULT (0), "is_new" boolean NOT NULL DEFAULT (1), "tags" text, "attributes" text, "specifications" text, "created_at" datetime NOT NULL DEFAULT (CURRENT_TIMESTAMP), "updated_at" datetime NOT NULL DEFAULT (CURRENT_TIMESTAMP), "deleted_at" datetime, "last_sold_at" datetime, "last_received_at" datetime, "created_by" integer, "updated_by" integer, "deleted_by" integer, "total_sold" integer NOT NULL DEFAULT (0), "total_returned" integer NOT NULL DEFAULT (0), "total_profit" decimal(12,2) NOT NULL DEFAULT (0), "average_rating" decimal(3,2) NOT NULL DEFAULT (0), "review_count" integer NOT NULL DEFAULT (0), CONSTRAINT "UQ_c44ac33a05b144dd0d9ddcf9327" UNIQUE ("sku"), CONSTRAINT "UQ_adfc522baf9d9b19cd7d9461b7e" UNIQUE ("barcode"))`);
        await queryRunner.query(`INSERT INTO "products"("id", "sku", "barcode", "upc", "name", "display_name", "description", "product_type", "category_id", "subcategory_id", "brand_id", "cost_price", "selling_price", "wholesale_price", "min_price", "max_price", "markup_percentage", "stock", "reserved_stock", "available_stock", "min_stock_level", "max_stock_level", "reorder_level", "tax_rate", "tax_type", "is_taxable", "discount_percentage", "discount_amount", "weight", "weight_unit", "length", "width", "height", "dimension_unit", "supplier_id", "supplier_sku", "supplier_price", "lead_time_days", "has_expiry", "shelf_life_days", "track_batch", "track_serial", "image_url", "image_urls", "thumbnail_url", "pos_quick_code", "pos_category_id", "is_quick_sale", "is_hidden", "kitchen_printer_id", "preparation_time", "loyalty_points_earn", "is_reward_product", "reward_points_cost", "status", "is_active", "is_deleted", "is_bestseller", "is_featured", "is_new", "tags", "attributes", "specifications", "created_at", "updated_at", "deleted_at", "last_sold_at", "last_received_at", "created_by", "updated_by", "deleted_by", "total_sold", "total_returned", "total_profit", "average_rating", "review_count") SELECT "id", "sku", "barcode", "upc", "name", "display_name", "description", "product_type", "category_id", "subcategory_id", "brand_id", "cost_price", "selling_price", "wholesale_price", "min_price", "max_price", "markup_percentage", "stock", "reserved_stock", "available_stock", "min_stock_level", "max_stock_level", "reorder_level", "tax_rate", "tax_type", "is_taxable", "discount_percentage", "discount_amount", "weight", "weight_unit", "length", "width", "height", "dimension_unit", "supplier_id", "supplier_sku", "supplier_price", "lead_time_days", "has_expiry", "shelf_life_days", "track_batch", "track_serial", "image_url", "image_urls", "thumbnail_url", "pos_quick_code", "pos_category_id", "is_quick_sale", "is_hidden", "kitchen_printer_id", "preparation_time", "loyalty_points_earn", "is_reward_product", "reward_points_cost", "status", "is_active", "is_deleted", "is_bestseller", "is_featured", "is_new", "tags", "attributes", "specifications", "created_at", "updated_at", "deleted_at", "last_sold_at", "last_received_at", "created_by", "updated_by", "deleted_by", "total_sold", "total_returned", "total_profit", "average_rating", "review_count" FROM "temporary_products"`);
        await queryRunner.query(`DROP TABLE "temporary_products"`);
        await queryRunner.query(`CREATE INDEX "idx_products_is_deleted" ON "products" ("is_deleted") `);
        await queryRunner.query(`CREATE INDEX "idx_products_total_sold" ON "products" ("total_sold") `);
        await queryRunner.query(`CREATE INDEX "idx_products_supplier_sku" ON "products" ("supplier_sku") `);
        await queryRunner.query(`CREATE INDEX "idx_products_sku_name" ON "products" ("sku", "name") `);
        await queryRunner.query(`CREATE INDEX "idx_products_created" ON "products" ("created_at") `);
        await queryRunner.query(`CREATE INDEX "idx_products_type" ON "products" ("product_type") `);
        await queryRunner.query(`CREATE INDEX "idx_products_pos_quick_code" ON "products" ("pos_quick_code") `);
        await queryRunner.query(`CREATE INDEX "idx_products_price" ON "products" ("selling_price") `);
        await queryRunner.query(`CREATE INDEX "idx_products_active" ON "products" ("is_active") `);
        await queryRunner.query(`CREATE INDEX "idx_products_stock" ON "products" ("stock") `);
        await queryRunner.query(`CREATE INDEX "idx_products_supplier" ON "products" ("supplier_id") `);
        await queryRunner.query(`CREATE INDEX "idx_products_category" ON "products" ("category_id") `);
        await queryRunner.query(`CREATE INDEX "idx_products_status" ON "products" ("status") `);
        await queryRunner.query(`CREATE INDEX "idx_products_name" ON "products" ("name") `);
        await queryRunner.query(`CREATE UNIQUE INDEX "idx_products_barcode" ON "products" ("barcode") `);
        await queryRunner.query(`CREATE UNIQUE INDEX "idx_products_sku" ON "products" ("sku") `);
        await queryRunner.query(`DROP INDEX "idx_sale_items_inventory_synced"`);
        await queryRunner.query(`DROP INDEX "idx_sale_items_sync_id"`);
        await queryRunner.query(`DROP INDEX "idx_sale_items_is_returned"`);
        await queryRunner.query(`DROP INDEX "idx_sale_items_product_id"`);
        await queryRunner.query(`DROP INDEX "idx_sale_items_sale_id"`);
        await queryRunner.query(`ALTER TABLE "sale_items" RENAME TO "temporary_sale_items"`);
        await queryRunner.query(`CREATE TABLE "sale_items" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "sale_id" integer NOT NULL, "product_id" integer NOT NULL, "warehouse_id" varchar, "sync_id" varchar, "inventory_synced" boolean NOT NULL DEFAULT (0), "product_name" varchar NOT NULL, "product_barcode" varchar, "product_sku" varchar, "is_variant" boolean NOT NULL DEFAULT (0), "variant_name" varchar, "quantity" integer NOT NULL, "unit_price" integer NOT NULL, "total_price" integer NOT NULL, "cost_price" integer, "profit" integer, "discount_percentage" decimal(5,2) NOT NULL DEFAULT (0), "discount_amount" integer NOT NULL DEFAULT (0), "price_before_discount" integer, "returned_quantity" integer NOT NULL DEFAULT (0), "is_returned" boolean NOT NULL DEFAULT (0), "return_reason" varchar, "return_date" datetime, "created_at" datetime NOT NULL DEFAULT (datetime('now')), "updated_at" datetime NOT NULL DEFAULT (datetime('now')))`);
        await queryRunner.query(`INSERT INTO "sale_items"("id", "sale_id", "product_id", "warehouse_id", "sync_id", "inventory_synced", "product_name", "product_barcode", "product_sku", "is_variant", "variant_name", "quantity", "unit_price", "total_price", "cost_price", "profit", "discount_percentage", "discount_amount", "price_before_discount", "returned_quantity", "is_returned", "return_reason", "return_date", "created_at", "updated_at") SELECT "id", "sale_id", "product_id", "warehouse_id", "sync_id", "inventory_synced", "product_name", "product_barcode", "product_sku", "is_variant", "variant_name", "quantity", "unit_price", "total_price", "cost_price", "profit", "discount_percentage", "discount_amount", "price_before_discount", "returned_quantity", "is_returned", "return_reason", "return_date", "created_at", "updated_at" FROM "temporary_sale_items"`);
        await queryRunner.query(`DROP TABLE "temporary_sale_items"`);
        await queryRunner.query(`CREATE INDEX "idx_sale_items_inventory_synced" ON "sale_items" ("inventory_synced") `);
        await queryRunner.query(`CREATE INDEX "idx_sale_items_sync_id" ON "sale_items" ("sync_id") `);
        await queryRunner.query(`CREATE INDEX "idx_sale_items_is_returned" ON "sale_items" ("is_returned") `);
        await queryRunner.query(`CREATE INDEX "idx_sale_items_product_id" ON "sale_items" ("product_id") `);
        await queryRunner.query(`CREATE INDEX "idx_sale_items_sale_id" ON "sale_items" ("sale_id") `);
        await queryRunner.query(`DROP INDEX "idx_sales_inventory_synced"`);
        await queryRunner.query(`DROP INDEX "idx_sales_customer"`);
        await queryRunner.query(`DROP INDEX "idx_sales_warehouse"`);
        await queryRunner.query(`DROP INDEX "idx_sales_reference_number"`);
        await queryRunner.query(`DROP INDEX "idx_sales_status"`);
        await queryRunner.query(`DROP INDEX "idx_sales_datetime"`);
        await queryRunner.query(`ALTER TABLE "sales" RENAME TO "temporary_sales"`);
        await queryRunner.query(`CREATE TABLE "sales" ("id" integer PRIMARY KEY AUTOINCREMENT NOT NULL, "datetime" datetime NOT NULL DEFAULT (CURRENT_TIMESTAMP), "total" integer NOT NULL, "warehouse_id" varchar, "warehouse_name" varchar, "customer_id" integer, "customer_name" varchar, "customer_phone" varchar, "customer_email" varchar, "subtotal" integer NOT NULL DEFAULT (0), "discount_amount" integer NOT NULL DEFAULT (0), "tax_amount" integer NOT NULL DEFAULT (0), "payment_method" varchar NOT NULL DEFAULT ('cash'), "status" varchar NOT NULL DEFAULT ('completed'), "reference_number" varchar, "inventory_synced" boolean NOT NULL DEFAULT (0), "inventory_sync_date" datetime, "user_id" integer, "user_name" varchar, "notes" text, "created_at" datetime NOT NULL DEFAULT (datetime('now')), "updated_at" datetime NOT NULL DEFAULT (datetime('now')), CONSTRAINT "UQ_7eda0726704e0f1258eeb58ab4a" UNIQUE ("reference_number"))`);
        await queryRunner.query(`INSERT INTO "sales"("id", "datetime", "total", "warehouse_id", "warehouse_name", "customer_id", "customer_name", "customer_phone", "customer_email", "subtotal", "discount_amount", "tax_amount", "payment_method", "status", "reference_number", "inventory_synced", "inventory_sync_date", "user_id", "user_name", "notes", "created_at", "updated_at") SELECT "id", "datetime", "total", "warehouse_id", "warehouse_name", "customer_id", "customer_name", "customer_phone", "customer_email", "subtotal", "discount_amount", "tax_amount", "payment_method", "status", "reference_number", "inventory_synced", "inventory_sync_date", "user_id", "user_name", "notes", "created_at", "updated_at" FROM "temporary_sales"`);
        await queryRunner.query(`DROP TABLE "temporary_sales"`);
        await queryRunner.query(`CREATE INDEX "idx_sales_inventory_synced" ON "sales" ("inventory_synced") `);
        await queryRunner.query(`CREATE INDEX "idx_sales_customer" ON "sales" ("customer_id") `);
        await queryRunner.query(`CREATE INDEX "idx_sales_warehouse" ON "sales" ("warehouse_id") `);
        await queryRunner.query(`CREATE INDEX "idx_sales_reference_number" ON "sales" ("reference_number") `);
        await queryRunner.query(`CREATE INDEX "idx_sales_status" ON "sales" ("status") `);
        await queryRunner.query(`CREATE INDEX "idx_sales_datetime" ON "sales" ("datetime") `);
        await queryRunner.query(`DROP INDEX "idx_suppliers_name"`);
        await queryRunner.query(`DROP INDEX "idx_suppliers_code"`);
        await queryRunner.query(`DROP TABLE "suppliers"`);
        await queryRunner.query(`DROP INDEX "idx_variants_sku"`);
        await queryRunner.query(`DROP INDEX "idx_variants_product"`);
        await queryRunner.query(`DROP TABLE "product_variants"`);
        await queryRunner.query(`DROP INDEX "idx_categories_parent"`);
        await queryRunner.query(`DROP INDEX "idx_categories_name"`);
        await queryRunner.query(`DROP TABLE "categories"`);
        await queryRunner.query(`DROP INDEX "idx_brands_name"`);
        await queryRunner.query(`DROP TABLE "brands"`);
        await queryRunner.query(`DROP INDEX "idx_customers_last_purchase"`);
        await queryRunner.query(`DROP INDEX "idx_customers_company_name"`);
        await queryRunner.query(`DROP INDEX "idx_customers_customer_type"`);
        await queryRunner.query(`DROP INDEX "idx_customers_status"`);
        await queryRunner.query(`DROP INDEX "idx_customers_phone"`);
        await queryRunner.query(`DROP INDEX "idx_customers_email"`);
        await queryRunner.query(`DROP INDEX "idx_customers_customer_code"`);
        await queryRunner.query(`DROP TABLE "customers"`);
        await queryRunner.query(`DROP INDEX "idx_earning_rules_priority"`);
        await queryRunner.query(`DROP INDEX "idx_earning_rules_type"`);
        await queryRunner.query(`DROP INDEX "idx_earning_rules_active"`);
        await queryRunner.query(`DROP TABLE "points_earning_rules"`);
        await queryRunner.query(`DROP INDEX "idx_redemption_history_date"`);
        await queryRunner.query(`DROP INDEX "idx_redemption_history_status"`);
        await queryRunner.query(`DROP INDEX "idx_redemption_history_reward"`);
        await queryRunner.query(`DROP INDEX "idx_redemption_history_customer"`);
        await queryRunner.query(`DROP INDEX "idx_redemption_history_code"`);
        await queryRunner.query(`DROP TABLE "redemption_history"`);
        await queryRunner.query(`DROP INDEX "idx_reward_items_points"`);
        await queryRunner.query(`DROP INDEX "idx_reward_items_active"`);
        await queryRunner.query(`DROP INDEX "idx_reward_items_category"`);
        await queryRunner.query(`DROP INDEX "idx_reward_items_code"`);
        await queryRunner.query(`DROP TABLE "reward_items"`);
        await queryRunner.query(`DROP INDEX "idx_points_transactions_expiration"`);
        await queryRunner.query(`DROP INDEX "idx_points_transactions_created"`);
        await queryRunner.query(`DROP INDEX "idx_points_transactions_reference"`);
        await queryRunner.query(`DROP INDEX "idx_points_transactions_type"`);
        await queryRunner.query(`DROP INDEX "idx_points_transactions_customer"`);
        await queryRunner.query(`DROP TABLE "points_transactions"`);
        await queryRunner.query(`DROP INDEX "idx_loyalty_customers_points"`);
        await queryRunner.query(`DROP INDEX "idx_loyalty_customers_active"`);
        await queryRunner.query(`DROP INDEX "idx_loyalty_customers_tier"`);
        await queryRunner.query(`DROP INDEX "idx_loyalty_customers_customer"`);
        await queryRunner.query(`DROP TABLE "loyalty_customers"`);
        await queryRunner.query(`DROP INDEX "idx_loyalty_programs_created"`);
        await queryRunner.query(`DROP INDEX "idx_loyalty_programs_active"`);
        await queryRunner.query(`DROP TABLE "loyalty_programs"`);
        await queryRunner.query(`DROP INDEX "idx_customer_transactions_status"`);
        await queryRunner.query(`DROP INDEX "idx_customer_transactions_date"`);
        await queryRunner.query(`DROP INDEX "idx_customer_transactions_type"`);
        await queryRunner.query(`DROP INDEX "idx_customer_transactions_customer_id"`);
        await queryRunner.query(`DROP TABLE "customer_transactions"`);
        await queryRunner.query(`DROP INDEX "idx_customer_contacts_is_default"`);
        await queryRunner.query(`DROP INDEX "idx_customer_contacts_email"`);
        await queryRunner.query(`DROP INDEX "idx_customer_contacts_customer_id"`);
        await queryRunner.query(`DROP TABLE "customer_contacts"`);
        await queryRunner.query(`DROP INDEX "idx_license_status_expires"`);
        await queryRunner.query(`DROP INDEX "idx_next_sync"`);
        await queryRunner.query(`DROP INDEX "idx_expires_at"`);
        await queryRunner.query(`DROP INDEX "idx_license_key"`);
        await queryRunner.query(`DROP TABLE "license_cache"`);
        await queryRunner.query(`DROP INDEX "idx_user_activity_entity"`);
        await queryRunner.query(`DROP INDEX "idx_user_activity_action"`);
        await queryRunner.query(`DROP INDEX "idx_user_activity_user"`);
        await queryRunner.query(`DROP TABLE "user_activities"`);
        await queryRunner.query(`DROP INDEX "idx_system_settings_type_key"`);
        await queryRunner.query(`DROP TABLE "system_settings"`);
        await queryRunner.query(`DROP INDEX "IDX_1652c84026ff083cb79617c229"`);
        await queryRunner.query(`DROP INDEX "IDX_2cc5a2c8f1e2da066d1903d058"`);
        await queryRunner.query(`DROP INDEX "IDX_81bb91edf39554fae2d4067b4c"`);
        await queryRunner.query(`DROP INDEX "IDX_ebdb4d54c8de7847c0f7a9e4fb"`);
        await queryRunner.query(`DROP TABLE "price_history"`);
        await queryRunner.query(`DROP INDEX "idx_inventory_transaction_logs_date_action"`);
        await queryRunner.query(`DROP INDEX "idx_inventory_transaction_logs_user"`);
        await queryRunner.query(`DROP INDEX "idx_inventory_transaction_logs_reference"`);
        await queryRunner.query(`DROP INDEX "idx_inventory_transaction_logs_product"`);
        await queryRunner.query(`DROP INDEX "idx_inventory_transaction_logs_action"`);
        await queryRunner.query(`DROP INDEX "idx_inventory_transaction_logs_created_at"`);
        await queryRunner.query(`DROP TABLE "inventory_transaction_logs"`);
        await queryRunner.query(`DROP INDEX "idx_users_employee_id"`);
        await queryRunner.query(`DROP INDEX "idx_users_email"`);
        await queryRunner.query(`DROP INDEX "idx_users_is_active"`);
        await queryRunner.query(`DROP INDEX "idx_users_role"`);
        await queryRunner.query(`DROP INDEX "idx_users_username"`);
        await queryRunner.query(`DROP TABLE "users"`);
        await queryRunner.query(`DROP INDEX "idx_audit_action_time"`);
        await queryRunner.query(`DROP INDEX "idx_audit_user"`);
        await queryRunner.query(`DROP INDEX "idx_audit_entity"`);
        await queryRunner.query(`DROP TABLE "audit_trails"`);
        await queryRunner.query(`DROP INDEX "idx_products_is_deleted"`);
        await queryRunner.query(`DROP INDEX "idx_products_total_sold"`);
        await queryRunner.query(`DROP INDEX "idx_products_supplier_sku"`);
        await queryRunner.query(`DROP INDEX "idx_products_sku_name"`);
        await queryRunner.query(`DROP INDEX "idx_products_created"`);
        await queryRunner.query(`DROP INDEX "idx_products_type"`);
        await queryRunner.query(`DROP INDEX "idx_products_pos_quick_code"`);
        await queryRunner.query(`DROP INDEX "idx_products_price"`);
        await queryRunner.query(`DROP INDEX "idx_products_active"`);
        await queryRunner.query(`DROP INDEX "idx_products_stock"`);
        await queryRunner.query(`DROP INDEX "idx_products_supplier"`);
        await queryRunner.query(`DROP INDEX "idx_products_category"`);
        await queryRunner.query(`DROP INDEX "idx_products_status"`);
        await queryRunner.query(`DROP INDEX "idx_products_name"`);
        await queryRunner.query(`DROP INDEX "idx_products_barcode"`);
        await queryRunner.query(`DROP INDEX "idx_products_sku"`);
        await queryRunner.query(`DROP TABLE "products"`);
        await queryRunner.query(`DROP INDEX "idx_sale_items_inventory_synced"`);
        await queryRunner.query(`DROP INDEX "idx_sale_items_sync_id"`);
        await queryRunner.query(`DROP INDEX "idx_sale_items_is_returned"`);
        await queryRunner.query(`DROP INDEX "idx_sale_items_product_id"`);
        await queryRunner.query(`DROP INDEX "idx_sale_items_sale_id"`);
        await queryRunner.query(`DROP TABLE "sale_items"`);
        await queryRunner.query(`DROP INDEX "idx_sales_inventory_synced"`);
        await queryRunner.query(`DROP INDEX "idx_sales_customer"`);
        await queryRunner.query(`DROP INDEX "idx_sales_warehouse"`);
        await queryRunner.query(`DROP INDEX "idx_sales_reference_number"`);
        await queryRunner.query(`DROP INDEX "idx_sales_status"`);
        await queryRunner.query(`DROP INDEX "idx_sales_datetime"`);
        await queryRunner.query(`DROP TABLE "sales"`);
    }
}
